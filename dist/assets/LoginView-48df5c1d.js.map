{"version":3,"file":"LoginView-48df5c1d.js","sources":["../../src/ui/utils/featureCheck.ts","../../src/ui/views/login/MissingFeatureModal.tsx","../../src/ui/views/login/LoginView.tsx"],"sourcesContent":["export enum MissingFeature {\n  SHARED_ARRAY_BUFFER = \"SHARED_ARRAY_BUFFER\",\n  MIN_FIREFOX_VERSION = \"MIN_FIREFOX_VERSION\",\n  WEB_GL2 = \"WEB_GL2\",\n  WEB_GL_HARDWARE_ACC = \"WEB_GL_HARDWARE_ACC\",\n  WEB_RTC = \"WEB_RTC\",\n  INDEXED_DB = \"INDEXED_DB\",\n}\n\nexport const SUPPORTED_FIREFOX_VERSION = 104;\n\nfunction sharedArrayBufferSupport() {\n  return typeof window.SharedArrayBuffer === \"function\";\n}\n\nfunction firefoxBrowser() {\n  return navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\n}\n\nexport function getFirefoxVersion() {\n  const matches = navigator.userAgent.toLocaleLowerCase().match(/firefox\\/([0-9]+\\.*[0-9]*)/);\n  if (matches) {\n    const version = parseInt(matches[1]);\n    if (typeof version === \"number\") return version;\n  }\n  return undefined;\n}\n\nfunction getTestCanvas() {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = 1;\n  canvas.height = 1;\n  canvas.style.position = \"fixed\";\n  canvas.style.opacity = \"0\";\n  canvas.style.visibility = \"hidden\";\n  return canvas;\n}\n\nfunction webGL2Support() {\n  const canvas = getTestCanvas();\n  document.body.append(canvas);\n  const support = !!canvas.getContext(\"webgl2\");\n  document.body.removeChild(canvas);\n  return support;\n}\n\nfunction webGLHardwareAccSupport() {\n  const canvas = getTestCanvas();\n  document.body.append(canvas);\n  const support = !!canvas.getContext(\"webgl2\", { failIfMajorPerformanceCaveat: true });\n  document.body.removeChild(canvas);\n  return support;\n}\n\nfunction webRTCSupport() {\n  return [\"RTCPeerConnection\", \"webkitRTCPeerConnection\", \"mozRTCPeerConnection\", \"RTCIceGatherer\"].some(\n    (prop) => prop in window\n  );\n}\n\nasync function indexedDBSupport(): Promise<boolean> {\n  const testDBName = `featureCheck-${Math.random()}`;\n  return new Promise((resolve) => {\n    let db;\n    try {\n      db = indexedDB.open(testDBName);\n    } catch {\n      resolve(false);\n      return;\n    }\n    db.onsuccess = () => {\n      resolve(true);\n      indexedDB.deleteDatabase(testDBName);\n    };\n    db.onerror = () => {\n      resolve(false);\n      indexedDB.deleteDatabase(testDBName);\n    };\n  });\n}\n\nexport async function getMissingFeature() {\n  const missingFeature: MissingFeature[] = [];\n\n  if (sharedArrayBufferSupport() === false) {\n    missingFeature.push(MissingFeature.SHARED_ARRAY_BUFFER);\n  }\n\n  if (firefoxBrowser()) {\n    const version = getFirefoxVersion();\n    if (version && version < SUPPORTED_FIREFOX_VERSION) {\n      missingFeature.push(MissingFeature.MIN_FIREFOX_VERSION);\n    }\n  }\n\n  if (webGL2Support() === false) {\n    missingFeature.push(MissingFeature.WEB_GL2);\n  }\n\n  if (webGLHardwareAccSupport() === false) {\n    missingFeature.push(MissingFeature.WEB_GL_HARDWARE_ACC);\n  }\n\n  if (webRTCSupport() === false) {\n    missingFeature.push(MissingFeature.WEB_RTC);\n  }\n  if ((await indexedDBSupport()) === false) {\n    missingFeature.push(MissingFeature.INDEXED_DB);\n  }\n\n  return missingFeature;\n}\n","import { useNavigate } from \"react-router-dom\";\n\nimport { MissingFeature, SUPPORTED_FIREFOX_VERSION } from \"../../utils/featureCheck\";\nimport { Modal } from \"../../atoms/modal/Modal\";\nimport { Content } from \"../../atoms/content/Content\";\nimport { Scroll } from \"../../atoms/scroll/Scroll\";\nimport { Footer } from \"../../atoms/footer/Footer\";\nimport { Text } from \"../../atoms/text/Text\";\nimport { Button } from \"../../atoms/button/Button\";\n\nexport function getMissingFeatureToMsg(missingFeature: MissingFeature) {\n  switch (missingFeature) {\n    case MissingFeature.SHARED_ARRAY_BUFFER:\n      return (\n        <>\n          No{\" \"}\n          <a\n            href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\"\n            target=\"_blank\"\n          >\n            SharedArrayBuffer\n          </a>{\" \"}\n          found.\n        </>\n      );\n    case MissingFeature.MIN_FIREFOX_VERSION:\n      return `Firefox version ${SUPPORTED_FIREFOX_VERSION} or below is not supported. Please update your browser.`;\n    case MissingFeature.WEB_GL2:\n      return \"No webGL2 support found.\";\n    case MissingFeature.WEB_GL_HARDWARE_ACC:\n      return \"WebGL2 Hardware acceleration is disabled.\";\n    case MissingFeature.WEB_RTC:\n      return \"WebRTC is not supported.\";\n    case MissingFeature.INDEXED_DB:\n      return \"Access to IndexedDB is disabled.\";\n  }\n}\n\nexport function MissingFeatureModal({ missingFeatures }: { missingFeatures: MissingFeature[] }) {\n  const navigate = useNavigate();\n  return (\n    <Modal className=\"MissingFeature\" overlayClassName=\"MissingFeature__overlay\" size=\"sm\" open={true}>\n      <Content\n        children={\n          <Scroll>\n            <div className=\"MissingFeature__content\">\n              <Text variant=\"h2\" weight=\"semi-bold\">\n                Incompatible Browser\n              </Text>\n              <Text>This may be happening because of following reason(s):</Text>\n              <ul>\n                {missingFeatures.map((m, i) => (\n                  <li key={i}>\n                    <Text variant=\"b2\" type=\"span\">\n                      {getMissingFeatureToMsg(m)}\n                    </Text>\n                  </li>\n                ))}\n              </ul>\n\n              <Button size=\"sm\" fill=\"outline\" onClick={() => navigate(\"/\")}>\n                Go Back\n              </Button>\n            </div>\n          </Scroll>\n        }\n        bottom={\n          <Footer\n            center={\n              <Text type=\"div\" variant=\"b2\">\n                <a href=\"https://matrix.to/#/#thirdroom-dev:matrix.org\" target=\"_blank\">\n                  Get help in our Matrix room.\n                </a>\n              </Text>\n            }\n          />\n        }\n      />\n    </Modal>\n  );\n}\n","import { ChangeEvent, KeyboardEvent, FormEvent, useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  AbortableOperation,\n  Client,\n  OidcApi,\n  Platform,\n  QueryLoginResult,\n  QueryOIDCResult,\n  URLRouter,\n} from \"@thirdroom/hydrogen-view-sdk\";\n\nimport { Text } from \"../../atoms/text/Text\";\nimport { Input } from \"../../atoms/input/Input\";\nimport { Button } from \"../../atoms/button/Button\";\nimport { Label } from \"../../atoms/text/Label\";\nimport { SettingTile } from \"../components/setting-tile/SettingTile\";\nimport { useHydrogen } from \"../../hooks/useHydrogen\";\nimport { Icon } from \"../../atoms/icon/Icon\";\nimport PlanetIC from \"../../../../res/ic/planet.svg\";\nimport { useDebounce } from \"../../hooks/useDebounce\";\nimport { Dots } from \"../../atoms/loading/Dots\";\nimport { IconButton } from \"../../atoms/button/IconButton\";\nimport ChevronBottom from \"../../../../res/ic/chevron-bottom.svg\";\nimport { DropdownMenu } from \"../../atoms/menu/DropdownMenu\";\nimport { DropdownMenuItem } from \"../../atoms/menu/DropdownMenuItem\";\nimport { getMissingFeature, MissingFeature } from \"../../utils/featureCheck\";\nimport { MissingFeatureModal } from \"./MissingFeatureModal\";\nimport \"./LoginView.css\";\nimport { useIsMounted } from \"../../hooks/useIsMounted\";\n\nfunction useQueryHomeserver(client: Client, homeserver: string) {\n  const queryRef = useRef<AbortableOperation<QueryLoginResult>>();\n  const [data, setData] = useState<{\n    homeserver: string;\n    result: undefined | QueryLoginResult;\n    error: string | undefined;\n    loading: boolean;\n  }>({\n    homeserver,\n    result: undefined,\n    error: undefined,\n    loading: false,\n  });\n\n  const queryCallback = useCallback(\n    async (homeserver: string) => {\n      setData({\n        homeserver,\n        result: undefined,\n        loading: true,\n        error: undefined,\n      });\n      const queryOperation = client.queryLogin(homeserver);\n      queryRef.current = queryOperation;\n      try {\n        const result = await queryOperation.result;\n        setData({\n          homeserver,\n          result,\n          loading: false,\n          error: undefined,\n        });\n      } catch (e: any) {\n        setData({\n          homeserver,\n          result: undefined,\n          loading: false,\n          error: e.name === \"AbortError\" ? undefined : \"Unable to find homeserver.\",\n        });\n      }\n      if (queryRef.current === queryOperation) {\n        queryRef.current = undefined;\n      }\n    },\n    [client]\n  );\n\n  const debouncedCallback = useDebounce(queryCallback, { wait: 400 });\n\n  useEffect(() => {\n    queryRef.current?.abort();\n    queryRef.current = undefined;\n    queryCallback(homeserver);\n  }, [homeserver, queryCallback]);\n\n  const queryHomeserver = (homeserver: string) => {\n    queryRef.current?.abort();\n    queryRef.current = undefined;\n    if (homeserver === \"\") return;\n    debouncedCallback(homeserver);\n  };\n\n  return { ...data, queryHomeserver };\n}\n\nasync function startOIDCLogin(\n  platform: Platform,\n  urlCreator: URLRouter,\n  homeserver: string,\n  oidc: QueryOIDCResult,\n  oidcApi: OidcApi,\n  guest: boolean\n) {\n  const { openUrl, settingsStorage } = platform;\n  const deviceScope = oidcApi.generateDeviceScope();\n  const param = oidcApi.generateParams({\n    scope: `openid urn:matrix:org.matrix.msc2967.client:api:* ${deviceScope}`,\n    redirectUri: urlCreator.createOIDCRedirectURL(),\n  });\n  const clientId = await oidcApi.clientId();\n  await Promise.all([\n    settingsStorage.setInt(`oidc_${param.state}_started_at`, Date.now()),\n    param.nonce ? settingsStorage.setString(`oidc_${param.state}_nonce`, param.nonce) : Promise.resolve(),\n    param.codeVerifier\n      ? settingsStorage.setString(`oidc_${param.state}_code_verifier`, param.codeVerifier)\n      : Promise.resolve(),\n    settingsStorage.setString(`oidc_${param.state}_redirect_uri`, param.redirectUri),\n    settingsStorage.setString(`oidc_${param.state}_homeserver`, homeserver),\n    settingsStorage.setString(`oidc_${param.state}_issuer`, oidc.issuer),\n    settingsStorage.setString(`oidc_${param.state}_client_id`, clientId),\n    settingsStorage.setString(`oidc_${param.state}_account_management_url`, oidc.account),\n  ]);\n\n  let link = await oidcApi.authorizationEndpoint(param);\n  if (guest) {\n    link += `&kc_idp_hint=${getMatchingClientConfig(platform, oidc.issuer)?.guestKeycloakIdpHint ?? \"guest\"}`;\n  }\n\n  openUrl(link);\n}\n\nfunction getMatchingClientConfig(platform: Platform, issuer: string) {\n  const normalisedIssuer = `${issuer}${issuer.endsWith(\"/\") ? \"\" : \"/\"}`;\n  return platform.config.staticOidcClients[normalisedIssuer];\n}\n\nexport default function LoginView() {\n  const { platform, urlRouter, login, client } = useHydrogen();\n  const [authenticating, setAuthenticating] = useState(false);\n  const [oidcError, setOidcError] = useState<string>();\n  const formRef = useRef<HTMLFormElement>(null);\n  const [open, setOpen] = useState(false);\n  const isMounted = useIsMounted();\n\n  const [missingFeatures, setMissingFeature] = useState<MissingFeature[]>([]);\n  useEffect(() => {\n    const run = async () => {\n      const missingFeature = await getMissingFeature();\n      if (!isMounted()) return;\n      setMissingFeature(missingFeature);\n    };\n    run();\n  }, [isMounted]);\n\n  const { homeserver, loading, error, result, queryHomeserver } = useQueryHomeserver(\n    client,\n    platform.config.defaultHomeServer\n  );\n  useEffect(() => {\n    if (!formRef.current) return;\n    const form = formRef.current.elements as typeof formRef.current.elements & {\n      homeserver: HTMLInputElement;\n    };\n    form.homeserver.value = platform.config.defaultHomeServer;\n  }, [platform]);\n\n  const handleHomeserverSelect = (hs: string) => {\n    if (!formRef.current) return;\n    const form = formRef.current.elements as typeof formRef.current.elements & {\n      homeserver: HTMLInputElement;\n    };\n    form.homeserver.value = hs;\n    setOidcError(undefined);\n    queryHomeserver(hs);\n  };\n\n  const handleKeyDown = (evt: KeyboardEvent<HTMLInputElement>) => {\n    if (evt.key === \"ArrowDown\") {\n      evt.preventDefault();\n      setOpen(true);\n    }\n  };\n\n  const handleHomeserverChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const hs = event.target.value.trim();\n    setOidcError(undefined);\n    queryHomeserver(hs);\n  };\n\n  const handleLogin = async (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!result) return;\n\n    const form = event.currentTarget.elements as typeof event.currentTarget.elements & {\n      homeserver: HTMLInputElement;\n      username: HTMLInputElement;\n      password: HTMLInputElement;\n    };\n    if (form.homeserver.value !== homeserver) {\n      return;\n    }\n\n    let loginMethod;\n    setAuthenticating(true);\n    setOidcError(undefined);\n    const guest = (event.nativeEvent as SubmitEvent).submitter?.id === \"guest\";\n\n    if (result.oidc) {\n      const { issuer } = result.oidc;\n      const oidcApi = new OidcApi({\n        issuer,\n        staticClients: platform.config.staticOidcClients,\n        request: platform.request,\n        encoding: platform.encoding,\n        crypto: platform.crypto,\n        urlCreator: urlRouter,\n      });\n      try {\n        await oidcApi.registration();\n        await oidcApi.metadata();\n        await startOIDCLogin(platform, urlRouter, result.homeserver, result.oidc, oidcApi, guest);\n      } catch (e) {\n        console.error(e);\n        setOidcError(\"This client is not registered by the homeserver.\");\n      }\n\n      setAuthenticating(false);\n      return;\n    } else if (result.password) {\n      const username = form.username.value.trim();\n      const password = form.password.value;\n      if (!username || !password || !result) return;\n\n      loginMethod = result.password(username, password);\n    }\n\n    if (!loginMethod) {\n      setAuthenticating(false);\n      return;\n    }\n    try {\n      await login(loginMethod);\n    } catch (error) {\n      console.error(error);\n    }\n    setAuthenticating(false);\n  };\n\n  const renderPasswordLogin = () => (\n    <>\n      <Text variant=\"s1\" weight=\"bold\">\n        Login\n      </Text>\n      <SettingTile\n        label={\n          <Label color=\"surface-low\" htmlFor=\"username\">\n            Username\n          </Label>\n        }\n      >\n        <Input name=\"username\" disabled={authenticating} required />\n      </SettingTile>\n      <SettingTile\n        label={\n          <Label color=\"surface-low\" htmlFor=\"password\">\n            Password\n          </Label>\n        }\n      >\n        <Input name=\"password\" type=\"password\" disabled={authenticating} required />\n      </SettingTile>\n      <Button size=\"lg\" variant=\"primary\" type=\"submit\" disabled={authenticating}>\n        {authenticating ? <Dots color=\"on-primary\" /> : \"Login\"}\n      </Button>\n    </>\n  );\n\n  if (missingFeatures.length > 0) return <MissingFeatureModal missingFeatures={missingFeatures} />;\n  return (\n    <div className=\"LoginView flex justify-center items-start\">\n      <div className=\"LoginView__card grow flex flex-column gap-xl\">\n        <div className=\"flex items-center gap-sm\">\n          <Icon src={PlanetIC} size=\"lg\" />\n          <Text variant=\"h2\" weight=\"bold\">\n            Third Room\n          </Text>\n        </div>\n        <form ref={formRef} className=\"LoginView__form flex flex-column gap-md\" onSubmit={handleLogin}>\n          <SettingTile\n            label={\n              <Label color=\"surface-low\" htmlFor=\"homeserver\">\n                Homeserver\n              </Label>\n            }\n          >\n            <Input\n              defaultValue={platform.config.defaultHomeServer}\n              name=\"homeserver\"\n              disabled={authenticating}\n              onChange={handleHomeserverChange}\n              required\n              onKeyDown={handleKeyDown}\n              after={\n                platform.config.homeserverList.length > 0 && (\n                  <DropdownMenu\n                    open={open}\n                    onOpenChange={setOpen}\n                    content={platform.config.homeserverList.map((hs: string) => (\n                      <DropdownMenuItem key={hs} onSelect={() => handleHomeserverSelect(hs)}>\n                        {hs}\n                      </DropdownMenuItem>\n                    ))}\n                  >\n                    <IconButton iconSrc={ChevronBottom} label=\"More Homeserver\" tabIndex={-1} />\n                  </DropdownMenu>\n                )\n              }\n            />\n          </SettingTile>\n          {oidcError && (\n            <Text color=\"danger\" variant=\"b2\">\n              {oidcError}\n            </Text>\n          )}\n          {loading && (\n            <div className=\"flex items-center gap-sm\">\n              <Dots />\n              <Text>Looking for homeserver</Text>\n            </div>\n          )}\n          {result &&\n            (result.oidc || result.password ? (\n              <>\n                {result.oidc && !oidcError ? (\n                  getMatchingClientConfig(platform, result.oidc.issuer)?.guestKeycloakIdpHint ? (\n                    <>\n                      <Button size=\"lg\" variant=\"primary\" type=\"submit\" disabled={authenticating}>\n                        {authenticating ? <Dots color=\"on-primary\" /> : \"Continue as User\"}\n                      </Button>\n                      <Text\n                        className=\"LoginView__orDivider flex items-center gap-sm\"\n                        variant=\"b3\"\n                        color=\"surface-low\"\n                        weight=\"bold\"\n                      >\n                        OR\n                      </Text>\n                      <Button\n                        id=\"guest\"\n                        size=\"lg\"\n                        variant=\"primary\"\n                        fill=\"outline\"\n                        type=\"submit\"\n                        disabled={authenticating}\n                      >\n                        {authenticating ? <Dots color=\"primary\" /> : \"Continue as Guest\"}\n                      </Button>\n                    </>\n                  ) : (\n                    <Button size=\"lg\" variant=\"primary\" type=\"submit\" disabled={authenticating}>\n                      {authenticating ? <Dots color=\"on-primary\" /> : \"Continue\"}\n                    </Button>\n                  )\n                ) : (\n                  result.password && renderPasswordLogin()\n                )}\n              </>\n            ) : (\n              <Text color=\"danger\" variant=\"b2\">\n                This client is not supported by the homeserver.\n              </Text>\n            ))}\n          {error && (\n            <Text color=\"danger\" variant=\"b2\">\n              {error}\n            </Text>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":["MissingFeature","SUPPORTED_FIREFOX_VERSION","sharedArrayBufferSupport","firefoxBrowser","getFirefoxVersion","matches","version","getTestCanvas","canvas","webGL2Support","support","webGLHardwareAccSupport","webRTCSupport","prop","indexedDBSupport","testDBName","resolve","db","getMissingFeature","missingFeature","getMissingFeatureToMsg","jsxs","Fragment","jsx","MissingFeatureModal","missingFeatures","navigate","useNavigate","Modal","Content","Scroll","Text","m","i","Button","Footer","useQueryHomeserver","client","homeserver","queryRef","useRef","data","setData","useState","queryCallback","useCallback","queryOperation","result","e","debouncedCallback","useDebounce","useEffect","_a","startOIDCLogin","platform","urlCreator","oidc","oidcApi","guest","openUrl","settingsStorage","deviceScope","param","clientId","link","getMatchingClientConfig","issuer","normalisedIssuer","LoginView","urlRouter","login","useHydrogen","authenticating","setAuthenticating","oidcError","setOidcError","formRef","open","setOpen","isMounted","useIsMounted","setMissingFeature","loading","error","queryHomeserver","form","handleHomeserverSelect","hs","handleKeyDown","evt","handleHomeserverChange","event","handleLogin","loginMethod","OidcApi","username","password","renderPasswordLogin","SettingTile","Label","Input","Dots","Icon","PlanetIC","DropdownMenu","DropdownMenuItem","IconButton","ChevronBottom"],"mappings":"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"}