{"version":3,"file":"WorldThumbnail-72ae1991.js","sources":["../../src/ui/views/session/world/WorldThumbnail.tsx"],"sourcesContent":["import classNames from \"classnames\";\nimport { useAtomValue } from \"jotai\";\nimport { useEffect, useState } from \"react\";\n\nimport { useHydrogen } from \"../../../hooks/useHydrogen\";\nimport { useIsMounted } from \"../../../hooks/useIsMounted\";\nimport { overlayVisibilityAtom } from \"../../../state/overlayVisibility\";\nimport { overlayWorldAtom } from \"../../../state/overlayWorld\";\nimport { worldAtom } from \"../../../state/world\";\nimport { loadImageUrl } from \"../../../utils/common\";\nimport \"./WorldThumbnail.css\";\n\nexport function WorldThumbnail() {\n  const selectedWorldId = useAtomValue(overlayWorldAtom);\n  const { worldId, entered } = useAtomValue(worldAtom);\n  const overlayVisible = useAtomValue(overlayVisibilityAtom);\n\n  const previewId = selectedWorldId ?? worldId;\n\n  const { session } = useHydrogen(true);\n  const [worldPreview, setWorldPreview] = useState<{ url?: string; thumbnail: string } | undefined>();\n  const isMounted = useIsMounted();\n\n  useEffect(() => {\n    let selectedWorldChanged = false;\n    const world = previewId ? session.rooms.get(previewId) : undefined;\n    if (world) {\n      world.getStateEvent(\"org.matrix.msc3815.world\").then((result: any) => {\n        const scenePreviewUrl = result?.event?.content?.scene_preview_url as string | unknown;\n        let scenePreviewThumbnail = scenePreviewUrl;\n\n        if (typeof scenePreviewUrl === \"string\" && scenePreviewUrl.startsWith(\"mxc:\")) {\n          scenePreviewThumbnail = session.mediaRepository.mxcUrlThumbnail(scenePreviewUrl, 32, 32, \"crop\");\n          const downloadUrl = session.mediaRepository.mxcUrl(scenePreviewUrl);\n          if (downloadUrl)\n            loadImageUrl(downloadUrl).then((url) => {\n              if (selectedWorldChanged || !isMounted()) return;\n              setWorldPreview({\n                url,\n                thumbnail: url,\n              });\n            });\n        }\n\n        if (typeof scenePreviewThumbnail === \"string\")\n          setWorldPreview({\n            thumbnail: scenePreviewThumbnail,\n          });\n      });\n    } else {\n      setWorldPreview(undefined);\n    }\n    return () => {\n      selectedWorldChanged = true;\n    };\n  }, [session, previewId, isMounted]);\n\n  if ((!overlayVisible || worldId === selectedWorldId) && entered) return <></>;\n  return (\n    <div className={classNames(\"WorldThumbnail\", { \"WorldThumbnail--blur\": worldPreview && !worldPreview?.url })}>\n      {worldPreview && <img alt=\"World Preview\" src={worldPreview.url ?? worldPreview.thumbnail} />}\n    </div>\n  );\n}\n"],"names":["WorldThumbnail","selectedWorldId","useAtomValue","overlayWorldAtom","worldId","entered","worldAtom","overlayVisible","overlayVisibilityAtom","previewId","session","useHydrogen","worldPreview","setWorldPreview","useState","isMounted","useIsMounted","useEffect","selectedWorldChanged","world","result","scenePreviewUrl","_b","_a","scenePreviewThumbnail","downloadUrl","loadImageUrl","url","jsx","Fragment","classNames"],"mappings":"4LAYO,SAASA,GAAiB,CACzB,MAAAC,EAAkBC,EAAaC,CAAgB,EAC/C,CAAE,QAAAC,EAAS,QAAAC,CAAQ,EAAIH,EAAaI,CAAS,EAC7CC,EAAiBL,EAAaM,CAAqB,EAEnDC,EAAYR,GAAmBG,EAE/B,CAAE,QAAAM,CAAA,EAAYC,EAAY,EAAI,EAC9B,CAACC,EAAcC,CAAe,EAAIC,EAA0D,SAAA,EAC5FC,EAAYC,IAoCb,OAlCLC,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAuB,GAC3B,MAAMC,EAAQV,EAAYC,EAAQ,MAAM,IAAID,CAAS,EAAI,OACzD,OAAIU,EACFA,EAAM,cAAc,0BAA0B,EAAE,KAAMC,GAAgB,SAC9D,MAAAC,GAAkBC,GAAAC,EAAAH,GAAA,YAAAA,EAAQ,QAAR,YAAAG,EAAe,UAAf,YAAAD,EAAwB,kBAChD,IAAIE,EAAwBH,EAE5B,GAAI,OAAOA,GAAoB,UAAYA,EAAgB,WAAW,MAAM,EAAG,CAC7EG,EAAwBd,EAAQ,gBAAgB,gBAAgBW,EAAiB,GAAI,GAAI,MAAM,EAC/F,MAAMI,EAAcf,EAAQ,gBAAgB,OAAOW,CAAe,EAC9DI,GACFC,EAAaD,CAAW,EAAE,KAAME,GAAQ,CAClCT,GAAwB,CAACH,EAAU,GACvBF,EAAA,CACd,IAAAc,EACA,UAAWA,CAAA,CACZ,CAAA,CACF,EAGD,OAAOH,GAA0B,UACnBX,EAAA,CACd,UAAWW,CAAA,CACZ,CAAA,CACJ,EAEDX,EAAgB,MAAS,EAEpB,IAAM,CACYK,EAAA,EAAA,CAExB,EAAA,CAACR,EAASD,EAAWM,CAAS,CAAC,GAE7B,CAACR,GAAkBH,IAAYH,IAAoBI,EAAkBuB,EAAAC,EAAA,CAAA,CAAA,EAExED,EAAC,OAAI,UAAWE,EAAW,iBAAkB,CAAE,uBAAwBlB,GAAgB,EAACA,GAAA,MAAAA,EAAc,IAAK,CAAA,EACxG,SAAAA,GAAiBgB,EAAA,MAAA,CAAI,IAAI,gBAAgB,IAAKhB,EAAa,KAAOA,EAAa,SAAW,CAAA,CAC7F,CAAA,CAEJ"}