var it=Object.defineProperty;var ot=(e,t,s)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var W=(e,t,s)=>(ot(e,typeof t!="symbol"?t+"":t,s),s);import{r as d,c as H,a as r,T as C,F as T,j as b,d as ue,n as Ie,b as A,X as Ce,Y as xe,Z as we,a0 as at,a1 as Ne,a2 as ct,a3 as lt,a4 as dt,a5 as ut,Q as me,a6 as he,B as mt,D as ke,a7 as oe,k as ht,a8 as ae,a9 as ft,K as pt,_ as fe,u as gt,aa as vt,m as Me}from"./main.cc7980d7.js";import{S as pe,I as U,a as B,C as j,D as bt}from"./DropdownMenu-c9ddf01c.js";import{L as ge,S as yt}from"./Label-b8166eab.js";import{w as Mt,u as St,c as It}from"./overlayVisibility-d52fa692.js";import{T as Ae,g as _e,H as ve,a as be,D as ye,A as Ct,h as xt,l as _}from"./mouse-left-107cf13e.js";import{b as G,i as le,U as wt,V as Nt,W as kt,X as At,Y as _t,P as Rt,a as Et,Z as Tt}from"./editor-9e67c00a.js";import{C as J}from"./cross-0b515b96.js";import{I as Pt,D as E}from"./index.module-9a456540.js";import{S as Re}from"./SettingTile-abd8ecde.js";import{u as Ut}from"./Footer-aa726a7f.js";import{c as $t}from"./math-0381bedb.js";function Dt(e){let t=0,s,n;if(e.length===0)return t;for(s=0;s<e.length;s++)n=e.charCodeAt(s),t=(t<<5)-t+n,t|=0;return Math.abs(t)}function Q(e){return Dt(e)%8+1}function ee(e,t,s,n){if(e){const i=t*s.devicePixelRatio;return n.mxcUrlThumbnail(e,i,i,"crop")}return null}function Bs(e,t){try{return e.mediaRepository.mxcUrl(t)}catch{return}}function te({className:e,style:t,name:s,bgColor:n,fgColor:i="white",shape:o="rounded",imageSrc:l,size:a="md",onClick:c}){const[u,m]=d.useState(!1);let p="h2";a==="xl"?p="h2":a==="lg"?p="s1":a==="md"||a=="sm"?p="b1":p="b3";const g=H("Avatar",`Avatar--${a}`,{"Avatar--circle":o==="circle"},e,"noselect");t=t??{},(u||!l)&&(t.backgroundColor=n);const M={className:g,"aria-label":s,style:t};d.useEffect(()=>{m(!1)},[l]);const I=!u&&l?r("img",{draggable:"false",src:l,alt:"",onError:()=>m(!0)}):r(C,{style:{color:i},variant:p,weight:"medium",type:"span",children:[...s][0]});return c?r("button",{onClick:c,...M,children:I}):r("div",{...M,children:I})}const Wt="/assets/peoples-9192a047.svg";function Vt({className:e,badge:t,children:s}){return t?b("div",{className:H("BadgeWrapper",e),children:[s,r("div",{className:"BadgeWrapper__item",children:t})]}):r(T,{children:s})}function zt({className:e,variant:t="primary",content:s}){const n=s!==void 0,i=H("NotificationBadge",`NotificationBadge--${t}`,{"NotificationBadge--with-content":n},e);return r("span",{className:i,children:n&&(typeof s=="string"||typeof s=="number"?r(C,{variant:"b3",color:`on-${t}`,type:"span",weight:"semi-bold",children:s}):s)})}function Ft(e,t,s,n){const i=ue(),[,o]=d.useReducer(c=>c+1,0),l=d.useRef(),a=d.useMemo(()=>{const c=p=>{i()&&(l.current=p,o())},u=e(),m=u.subscribe(t(c,u));return l.current=s(u),m},n);return d.useEffect(()=>a,[a]),l.current}var Ee=(e=>(e.None="none",e.CreateWorld="create_world",e.UserProfile="user_profile",e.WorldSettings="world_settings",e.Discover="discover",e))(Ee||{});const Bt=Ie({type:"none"}),Ht="/assets/info-07688084.svg",Se={loading:!0,error:void 0,value:void 0};function Te(e,t){const[s,n]=d.useState(Se);return d.useEffect(()=>{n(Se);let i=!1;return e().then(o=>{i||n({loading:!1,error:void 0,value:o})}).catch(o=>{i||n({loading:!1,error:o,value:void 0})}),()=>{i=!0}},t),s}function qt(e,t){const s=e.hsApi,[n,i]=d.useState(),{loading:o,error:l,value:a}=Te(async()=>{if(typeof n!="string"||n.trim()==="")return Promise.resolve(void 0);const c=await s.searchProfile(n,t).response();if(c.limited===void 0)return;const u={limited:c.limited,results:[]};return c==null||c.results.forEach(m=>{m.user_id!==e.userId&&u.results.push({userId:m.user_id,avatarUrl:m.avatar_url,displayName:m.display_name})}),u},[s,n,t]);return{loading:o,error:l,value:a,setSearchTerm:i}}function Ot({loading:e,suggestion:t,onSelect:s}){const{session:n,platform:i}=A(!0);return r(Re,{label:r(ge,{children:"Suggestions"}),children:e?r(C,{variant:"b3",children:"Looking for suggestion..."}):t?t.length===0?r(C,{variant:"b3",children:"No suggestion found."}):r(pe,{type:"hover",orientation:"horizontal",children:r("div",{style:{paddingBottom:"var(--sp-sm)"},className:"flex flex-wrap items-center gap-xs",children:(()=>t.map((o,l)=>r(Ae,{delayDuration:0,side:"top",content:o.userId,children:b(_e,{onClick:a=>s(o),children:[r(te,{imageSrc:o.avatarUrl?ee(o.avatarUrl,16,i,n.mediaRepository):void 0,name:o.displayName??o.userId.slice(1),bgColor:`var(--usercolor${Q(o.userId)})`,size:"xxs",shape:"circle"}),r(C,{className:"truncate",variant:"b3",weight:"medium",children:t.slice(0,l).find(a=>{var c,u;return((c=o.displayName)==null?void 0:c.toLowerCase())===((u=a.displayName)==null?void 0:u.toLowerCase())})?o.userId.slice(1):o.displayName??o.userId.slice(1)})]})},o.userId)))()})}):r(C,{variant:"b3",children:"Type username for suggestions."})})}function Hs(e){if(e.isGap)return Ce;if(e.eventType)switch(e.eventType){case"m.room.message":{if(e.isRedacted)return;const t=e.content;switch(t&&t.msgtype){case"m.text":case"m.notice":case"m.emote":return Ne;case"m.image":return at;default:return}}case"m.room.member":return we;case"m.room.encrypted":return e.isRedacted?void 0:xe;default:return}}function qs(e){if(e.isGap)return Ce;if(e.eventType)switch(e.eventType){case"m.room.message":{if(e.isRedacted)return;const t=e.content;switch(t&&t.msgtype){case"m.text":case"m.notice":case"m.emote":return Ne;default:return}}case"m.room.member":return we;case"m.room.encrypted":return e.isRedacted?void 0:xe;default:return}}class Kt extends ct{constructor(s){super(s);W(this,"_room");W(this,"_session");W(this,"_timelineVM");W(this,"_composerVM");W(this,"_tileClassForEntry");W(this,"_tileOptions");const{room:n,session:i,tileClassForEntry:o}=s;this._session=i,this._room=n,this._tileClassForEntry=o,this._timelineVM=null,this._composerVM=new lt(this)}async load(){let s;this._room._timeline?s=this._room._timeline:s=await this._room.openTimeline(),this._tileOptions=this.childOptions({session:this._session,roomVM:this,timeline:s,tileClassForEntry:this._tileClassForEntry}),this._timelineVM=new dt(this.childOptions({tileOptions:this._tileOptions,timeline:s}))}dispose(){super.dispose()}_createTile(s){if(this._tileOptions){const n=this._tileClassForEntry(s);if(n)return new n(s,this._tileOptions)}}async _sendMessage(s){if(!s)return!1;try{let n="m.text";return s.startsWith("/me ")&&(s=s.slice(4).trim(),n="m.emote"),await this._room.sendEvent("m.room.message",{msgtype:n,body:s}),!0}catch{return!1}}async _pickAndSendFile(){}async _sendFile(){}async _pickAndSendVideo(){}async _pickAndSendPicture(){}get room(){return this._room}get composerViewModel(){return this._composerVM}get timelineViewModel(){return this._timelineVM}get isEncrypted(){return this._room.isEncrypted}startReply(s){}}function Os(e,t){const{platform:s,logger:n,session:i,urlRouter:o,navigation:l}=A(!0),{loading:a,error:c,value:u}=Te(async()=>{const m=new Kt({session:i,room:e,tileClassForEntry:t,platform:s,logger:n,urlCreator:o,navigation:l});return await m.load(),m},[e,i,s,n,o,l]);return d.useEffect(()=>()=>{u&&u.dispose()},[u]),{loading:a,error:c,roomViewModel:u}}function Ks(e,t,s){d.useEffect(()=>{const n=new ut(t,s);if(e.current){const i=n.mount();for(i.querySelector(".Timeline_scroller").classList.add("legacy-scroll","legacy-scroll--vertical","legacy-scroll--invisible");e.current.lastChild;)e.current.removeChild(e.current.lastChild);e.current.append(i)}return()=>{n.unmount()}},[e,t,s])}function Pe(e,t){return Ft(e,(s,n)=>({onReset:()=>s(new Map(n)),onAdd:()=>s(new Map(n)),onUpdate:()=>s(new Map(n)),onRemove:()=>s(new Map(n))}),s=>new Map(s),t)}function js({title:e,desc:t,content:s,memberCount:n,onMembersClick:i,options:o}){return b("div",{className:"WorldPreviewCard flex flex-column gap-sm",children:[b("div",{className:"flex items-center gap-md",children:[b("div",{className:"WorldPreviewCard__content grow",children:[r(C,{className:"truncate",variant:"s1",weight:"semi-bold",children:e}),t&&r(C,{className:"",variant:"b3",color:"surface-low",children:t})]}),n!==void 0&&b("div",{role:i?"button":void 0,tabIndex:i?0:-1,onClick:i,className:"WorldPreviewCard__memberCount flex items-center",style:{cursor:i?"pointer":"inherit"},children:[r(U,{size:"sm",src:Wt}),r(C,{variant:"b3",weight:"bold",type:"span",children:n})]}),o&&r("div",{className:"shrink-0",children:o})]}),s&&r("div",{children:s})]})}function Ls(e,t){const s=t!=null&&t.startsWith("#")?me(e.rooms,t):t,n=Pe(()=>e.rooms,[e.rooms]);return s?n.get(s):void 0}const jt="/assets/add-user-286067e4.svg",Lt="/assets/volume-up-b850b2ad.svg";function Gt({avatar:e,content:t,options:s}){return b("div",{className:"MemberTile items-center flex gap-sm",children:[r("div",{className:"shrink-0 flex",children:e}),r("div",{className:"grow",children:t}),s&&r("div",{className:"shrink-0",children:s})]})}function Ue(e){const{session:t}=A(!0),[s,n]=d.useState(),[i,o]=d.useState([]),l=ue();return d.useEffect(()=>{const a=p=>{const g={invited:[],joined:[],leaved:[],banned:[]};for(const[,M]of p)M.membership==="invite"?g.invited.push(M):M.membership==="join"?g.joined.push(M):M.membership==="leave"?g.leaved.push(M):M.membership==="ban"&&g.banned.push(M);return g};let c;e.loadMemberList().then(p=>{if(!l())return;const{members:g}=p;n(a(g)),c=g.subscribe({onReset:()=>n(a(g)),onAdd:()=>n(a(g)),onUpdate:()=>n(a(g)),onRemove:()=>n(a(g))})});const u=he(t.callHandler.calls,e.id);let m;if(u){const p=()=>{const g=new Map;for(const[,M]of u.members){const I=M.member;g.has(I.userId)||g.set(I.userId,I)}return Array.from(g.values())};m=u.members.subscribe({onReset:()=>o(p()),onAdd:()=>o(p()),onUpdate:()=>o(p()),onRemove:()=>o(p())}),o(p())}return()=>{c==null||c(),m==null||m()}},[e,l,t]),{...s,active:i}}const Xt="/assets/more-horizontal-af503d76.svg",L="/assets/chevron-right-763e5b35.svg";function z({header:e,children:t}){return b("div",{className:"Category",children:[e,t]})}function F({before:e,title:t,after:s,options:n,onClick:i}){const o=b(T,{children:[e,r(C,{className:"truncate",variant:"b3",weight:"bold",children:t}),s]});return b("div",{className:"CategoryHeader flex items-center",children:[typeof i=="function"?r("button",{className:"CategoryHeader__content grow flex items-center gap-xxs",onClick:i,children:o}):r("div",{className:"CategoryHeader__content grow flex items-center gap-xxs",children:o}),n&&r("div",{className:"CategoryHeader__options shrink-0",children:n})]})}function Yt(e,t,s,n){const i=ue();d.useEffect(()=>{let o;return e.observeStateTypeAndKey(t,s).then(l=>{if(!i())return;const a=l.get();n(a),o=l.subscribe(n)}),()=>o==null?void 0:o()},[e,t,s,n,i])}var $e=(e=>(e[e.usersDefault=0]="usersDefault",e[e.stateDefault=50]="stateDefault",e[e.eventsDefault=0]="eventsDefault",e[e.invite=0]="invite",e[e.redact=50]="redact",e[e.kick=50]="kick",e[e.ban=50]="ban",e[e.historical=0]="historical",e))($e||{});function Jt(e){const[t,s]=d.useState(),n=d.useCallback(c=>{const{content:u}=c??{};s(u)},[]);Yt(e,"m.room.power_levels","",n);const i=d.useCallback(c=>{if(!t)return 0;const{users_default:u,users:m}=t;return m&&m[c]!==void 0?m[c]:u??0},[t]),o=d.useCallback((c,u)=>{if(!t)return u>=0;const{events:m,events_default:p}=t;return m&&c&&m[c]!==void 0?u>=m[c]:u>=(p??0)},[t]),l=d.useCallback((c,u)=>{if(!t)return u>=0;const{events:m,state_default:p}=t;return m&&c&&m[c]!==void 0?u>=m[c]:u>=(p??50)},[t]),a=d.useCallback((c,u)=>{const m=t==null?void 0:t[c];return m!==void 0?u>=m:u>=$e[c]},[t]);return{getPowerLevel:i,canSendEvent:o,canSendStateEvent:l,canDoAction:a}}const ce=/^@(\S+):(\S+)$/;function Zt({roomId:e,requestClose:t}){const{session:s,platform:n}=A(!0),i=d.useRef(null),[o,l]=d.useState(!1),[a,c]=d.useState([]),{loading:u,value:m,setSearchTerm:p}=qt(s),g=h=>{a.find(f=>f.userId===h.userId)||c(oe(a,f=>{f.push(h)}))},M=h=>{const f=a.findIndex(k=>k.userId===h.userId);f>=0&&c(oe(a,k=>{k.splice(f,1)}))},I=h=>{if(i.current){const f=i.current.elements;f.userIdInput.value="",f.userIdInput.focus()}g(h)},w=async h=>{if(o)return;const f=a.map(P=>P.userId);if(h.match(ce)&&f.push(h),f.length===0)return;l(!0);const k=Promise.allSettled(f.map(P=>s.hsApi.invite(e,P).response()));try{await k}catch{}l(!1),t()},V=async h=>{h.preventDefault();const f=h.currentTarget.userIdInput.value;w(f.trim())},N=Ut(d.useCallback(h=>{p(h)},[p]),{wait:400});return b("div",{className:"flex flex-column",children:[r(ve,{className:"shrink-0",left:r(be,{size:"lg",children:"Invite"}),right:r(B,{iconSrc:J,onClick:t,label:"Close"})}),b("form",{ref:i,onSubmit:V,className:"grow flex flex-column gap-sm",style:{padding:"var(--sp-md)"},children:[b("div",{className:"flex flex-column gap-sm",children:[r(Re,{label:b(T,{children:[r(ge,{children:"User Id"}),r(Ae,{content:"User id looks like @user:server.name",side:"right",children:r(U,{src:Ht,color:"surface-low",size:"sm"})})]}),children:r(Pt,{className:"flex-wrap",onChange:h=>{const f=h.currentTarget.value;f.startsWith("@")||N(f)},name:"userIdInput",maxLength:255,autoFocus:!0,onKeyDown:h=>{const f=h.currentTarget.value.trim();h.key===" "&&f.match(ce)&&(h.preventDefault(),I({userId:f})),h.key==="Enter"&&(f.length>0&&h.preventDefault(),f.match(ce)&&I({userId:f})),h.key==="Backspace"&&a.length>0&&f===""&&c(oe(a,k=>{k.pop()}))},placeholder:"@user:server.name",before:a.length>0&&r("div",{className:"flex gap-xs flex-wrap",style:{width:"100%",marginTop:"var(--sp-xs)"},children:a.map(h=>b(_e,{children:[r(te,{imageSrc:h.avatarUrl?ee(h.avatarUrl,16,n,s.mediaRepository):void 0,name:h.displayName??h.userId.slice(1),bgColor:`var(--usercolor${Q(h.userId)})`,size:"xxs",shape:"circle"}),r(C,{className:"truncate",variant:"b3",weight:"medium",children:h.userId.slice(1)}),r(B,{onClick:()=>M(h),size:"sm",iconSrc:J,label:"Remove"})]},h.userId))})})}),r("div",{style:{minHeight:"74px"},children:r(Ot,{loading:u,suggestion:m==null?void 0:m.results.filter(h=>!a.find(f=>f.userId===h.userId)),onSelect:I})})]}),b(mt,{size:"lg",type:"submit",children:[o&&r(ke,{color:"on-primary"}),o?"Inviting":"Invite"]})]})]})}function Qt(e){return Pe(()=>e.callHandler.calls,[e])}function es(e,t){return d.useMemo(()=>he(e,t),[e,t])}const ts=(e,t,s)=>e*(1-s)+t*s,ss=(e,t,s)=>$t((s-e)/(t-e),0,1),De=(e,t,s,n,i)=>ts(s,n,ss(e,t,i)),We=(e,t=!0)=>{const s=d.useRef(),n=d.useRef(),i=d.useCallback(o=>{if(n.current!=null){const l=o-n.current;e(l)}n.current=o,s.current=requestAnimationFrame(i)},[e]);d.useEffect(()=>{if(t)return s.current=requestAnimationFrame(i),()=>cancelAnimationFrame(s.current||0)},[t,i])},ns=e=>De(30,10,0,1,e),rs=e=>De(40,0,.01,1,e);function is({room:e,nametag:t,groupCall:s}){var I,w,V;const{joined:n}=Ue(e)??{},i=d.useRef(null),[o,l]=d.useState(!1),a=n==null?void 0:n.find(N=>N.userId===t.name),c=a?Array.from(new Map(s.members).values()).find(N=>N.userId===(a==null?void 0:a.userId)&&N.isConnected):void 0,u=a==null?void 0:a.avatarUrl,m=(a==null?void 0:a.userId)||t.name,{platform:p,session:g}=A(!0),M=c&&c.volumeDetector||((I=c==null?void 0:c.remoteMedia)==null?void 0:I.userMedia)&&(c.volumeDetector=p.mediaDevices.createVolumeMeasurer((w=c==null?void 0:c.remoteMedia)==null?void 0:w.userMedia,()=>{}));return We(()=>{if(i.current){const N=t.screenX,X=t.screenY,$=t.distanceFromCamera,h=t.inFrustum,f=i.current;if(h){const k=ns($),P=rs($);f.style.transform=`translate(${N}px, ${X}px) scale(${P})`,f.style.opacity=`${k}`}else f.style.opacity="0";l(M==null?void 0:M.isSpeaking)}}),r("div",{className:"Nametag",ref:i,children:b("div",{className:"Nametag--inner Text-b1",children:[r(te,{size:"xxs",shape:"circle",name:((V=a==null?void 0:a.displayName)==null?void 0:V.toUpperCase())||t.name.replace("@","").toUpperCase(),imageSrc:u?ee(u,25,p,g.mediaRepository):void 0,bgColor:`var(--usercolor${Q(m)})`,className:H("",{["Nametag--image"]:u,Speaking:o})}),(a==null?void 0:a.displayName)||t.name]})})}function Gs({room:e,show:t}){const s=G(),n=ht(Mt).worldId,[i,o]=d.useState([]),l=d.useCallback(u=>{o([...u])},[]);d.useEffect(()=>{const u=le(s,wt);return u.eventEmitter.addListener("nametags-changed",l),()=>{u.eventEmitter.removeListener("nametags-changed",l)}},[s,l]);const{session:a}=A(!0),c=he(a.callHandler.calls,n);return r("div",{children:t&&c&&i.map(u=>r(is,{room:e,nametag:u,groupCall:c},u.eid))})}function os({members:e,renderTile:t,isSpeaking:s}){const[,n]=d.useReducer(i=>i+1,0);return We(()=>{n()}),r(T,{children:e.map(i=>t(i,s(i.userId)))})}function as({room:e,requestClose:t}){const{session:s,platform:n}=A(!0),{active:i,invited:o,joined:l,leaved:a,banned:c}=Ue(e)??{},[u,m]=d.useState(!1),p=e.type==="org.matrix.msc3815.world",g=l==null?void 0:l.filter(v=>!(i!=null&&i.find(y=>y.userId===v.userId))),{canDoAction:M,getPowerLevel:I}=Jt(e),w=I(s.userId),V=M("invite",w),N=M("kick",w),X=M("ban",w),[$,h]=d.useState(!0),[f,k]=d.useState(!0),[P,Oe]=d.useState(!0),[se,Ke]=d.useState(!0),[ne,je]=d.useState(!0),Le=(v,y)=>s.hsApi.invite(v,y),Ge=(v,y)=>s.hsApi.kick(v,y),Xe=(v,y)=>s.hsApi.kick(v,y),Ye=(v,y)=>s.hsApi.ban(v,y),Je=(v,y)=>s.hsApi.unban(v,y),Ze=(v,y)=>ae(s,v,y,0),Qe=(v,y)=>ae(s,v,y,50),et=(v,y)=>ae(s,v,y,100),re=G(),tt=v=>At(re,v),st=Qt(s),ie=es(st,e.id),nt=Array.from(new Map(ie==null?void 0:ie.members).values()),rt=v=>{var O,K;const y=nt.find(Y=>Y.userId===v&&Y.isConnected),S=y&&y.volumeDetector||((O=y==null?void 0:y.remoteMedia)==null?void 0:O.userMedia)&&(y.volumeDetector=n.mediaDevices.createVolumeMeasurer((K=y==null?void 0:y.remoteMedia)==null?void 0:K.userMedia,()=>{}));return S==null?void 0:S.isSpeaking},q=(v,y)=>{const{userId:S,name:O,avatarUrl:K,membership:Y}=v,D=I(S),R=[r(E,{onSelect:()=>tt(S),children:Nt(re,S)?"Unmute":"Mute"},"mute"),r(E,{onSelect:()=>kt(re,S),children:"Ignore"},"ignore")];switch(Y){case"join":N&&w>D&&R.push(r(E,{onSelect:()=>Xe(e.id,S),children:"Kick"},"kick")),X&&w>D&&R.push(r(E,{onSelect:()=>Ye(e.id,S),children:"Ban"},"ban")),w===100&&(R.push(r(E,{disabled:D===0,onSelect:()=>Ze(e.id,S),children:"Make Member"},"make-member")),R.push(r(E,{disabled:D===50,onSelect:()=>Qe(e.id,S),children:"Make Moderator"},"make-mod")),R.push(r(E,{disabled:D===100,onSelect:()=>et(e.id,S),children:"Make Admin"},"make-admin")));break;case"ban":N&&w>D&&R.push(r(E,{onSelect:()=>Je(e.id,S),children:"Unban"},"unban"));break;case"invite":N&&w>D&&R.push(r(E,{onSelect:()=>Ge(e.id,S),children:"Disinvite"},"disinvite"));break;case"leave":V&&R.push(r(E,{onSelect:()=>Le(e.id,S),children:"Invite"},"invite"));break}return r(Gt,{avatar:r(Vt,{badge:y?r(zt,{variant:"secondary",content:r(U,{color:"on-secondary",size:"xs",src:Lt})}):null,children:r(te,{shape:"circle",name:O,imageSrc:K?ee(K,40,n,s.mediaRepository):void 0,bgColor:`var(--usercolor${Q(S)})`})}),content:b(T,{children:[r(C,{className:"truncate",weight:"medium",children:O}),r(C,{className:"truncate",color:"surface-low",variant:"b3",children:S})]}),options:R.length>0&&S!==s.userId&&r(bt,{content:R,children:r(B,{variant:"surface-low",label:"Options",iconSrc:Xt})})},S)};return b(T,{children:[r(ve,{left:r(be,{size:"lg",children:"Members"}),right:b("div",{className:"flex gap-sm",children:[r(ye,{open:u,onOpenChange:m,children:r(Zt,{roomId:e.id,requestClose:()=>m(!1)})}),M("invite",w)&&r(B,{iconSrc:jt,onClick:()=>m(!0),label:"Invite"}),r(B,{iconSrc:J,onClick:t,label:"Close"})]})}),r("div",{className:"flex",style:{height:"600px"},children:l===void 0?r("div",{className:"grow flex items-center justify-center",children:r(ke,{size:"lg"})}):r(pe,{type:"hover",style:{paddingBottom:"var(--sp-lg)"},children:b("div",{className:"flex flex-column gap-sm",children:[!!(o!=null&&o.length)&&r(z,{header:r(F,{title:"Invited",onClick:()=>Oe(!P),after:r(U,{src:P?j:L})}),children:P&&o.map(v=>q(v))}),!!(i!=null&&i.length)&&r(z,{header:r(F,{title:"Connected",onClick:()=>h(!$),after:r(U,{src:$?j:L})}),children:$&&r(os,{members:i,renderTile:q,isSpeaking:rt})}),!!(g!=null&&g.length)&&r(z,{header:r(F,{title:p?"Disconnected":"Joined",onClick:()=>k(!f),after:r(U,{src:f?j:L})}),children:f&&g.map(v=>q(v))}),!!(c!=null&&c.length)&&r(z,{header:r(F,{title:"Banned",onClick:()=>je(!ne),after:r(U,{src:ne?j:L})}),children:ne&&c.map(v=>q(v))}),!!(a!=null&&a.length)&&r(z,{header:r(F,{title:"Archived",onClick:()=>Ke(!se),after:r(U,{src:se?j:L})}),children:se&&a.map(v=>q(v))})]})})})]})}function cs(e){const[t,s]=d.useState("prompt");return d.useEffect(()=>{let n;function i(){s(this.state)}return navigator.permissions.query({name:e}).then(o=>{n=o,i.apply(o),o.addEventListener("change",i)}).catch(()=>{}),()=>{n==null||n.removeEventListener("change",i)}},[e]),t}function ls(e){return e==="NotAllowedError"?"Access to microphone was denied. Please allow it from browser address bar.":e==="NotFoundError"?"No microphone found.":"Unable to connect access microphone. Please connect a microphone and refresh the page."}function ds(e,t){return d.useCallback((n,i)=>new Promise(o=>{if(t==="denied"){o([void 0,"NotAllowedError"]);return}e.mediaDevices.getMediaTracks(n,i).then(l=>{o([l,void 0])}).catch(l=>{let a="Unknown";l.name==="NotAllowedError"&&(a="NotAllowedError"),l.name==="NotFoundError"&&(a="NotFoundError"),o([void 0,a])})}),[e,t])}function Ve(){const e=ft(),t=pt({path:"world/:worldId/*"}),[s,n]=e.hash.split("?"),i=new URLSearchParams(e.search||n).get("reload")??void 0;return[(t==null?void 0:t.params.worldId)??void 0,s.match(/^(#|!)\S+:\S+/)?s:void 0,i]}function Xs(){const{session:e}=A(!0),[t,s,n]=Ve(),i=s?me(e.rooms,s):t;return!i||!e.rooms.get(i)?[void 0,void 0]:[i,n]}function Ys(){const{session:e}=A(!0),[t,s]=Ve();return t&&e.rooms.get(t)===void 0?[t,void 0]:s&&me(e.rooms,s)===void 0?[void 0,s]:[void 0,void 0]}function Js({src:e,alt:t}){return r("img",{className:"ThumbnailImg",draggable:"false",src:e,alt:t})}const ze=["a","button","div","h2","h3","img","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>({...e,[t]:d.forwardRef((s,n)=>{const{asChild:i,...o}=s,l=i?yt:t;return d.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),d.createElement(l,fe({},o,{ref:n}))})}),{});function us(e,t=[]){let s=[];const n=()=>{const i=s.map(o=>d.createContext(o));return function(o){const l=(o==null?void 0:o[e])||i;return d.useMemo(()=>({[`__scope${e}`]:{...o,[e]:l}}),[o,l])}};return n.scopeName=e,[function(i,o){const l=d.createContext(o),a=s.length;function c(u){const{scope:m,children:p,...g}=u,M=(m==null?void 0:m[e][a])||l,I=d.useMemo(()=>g,Object.values(g));return d.createElement(M.Provider,{value:I},p)}return s=[...s,o],c.displayName=i+"Provider",[c,function(u,m){const p=(m==null?void 0:m[e][a])||l,g=d.useContext(p);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${u}\` must be used within \`${i}\``)}]},ms(n,...t)]}function ms(...e){const t=e[0];if(e.length===1)return t;const s=()=>{const n=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(i){const o=n.reduce((l,{useScope:a,scopeName:c})=>({...l,...a(i)[`__scope${c}`]}),{});return d.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return s.scopeName=t.scopeName,s}const[hs,Zs]=us("Progress"),[fs,ps]=hs("Progress"),Fe=d.forwardRef((e,t)=>{const{__scopeProgress:s,value:n,max:i,getValueLabel:o=vs,...l}=e,a=de(i)?i:100,c=He(n,a)?n:null,u=Z(c)?o(c,a):void 0;return d.createElement(fs,{scope:s,value:c,max:a},d.createElement(ze.div,fe({"aria-valuemax":a,"aria-valuemin":0,"aria-valuenow":Z(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":Be(c,a),"data-value":c??void 0,"data-max":a},l,{ref:t})))});Fe.propTypes={max(e,t,s){const n=e[t],i=String(n);return n&&!de(n)?new Error(function(o,l){return`Invalid prop \`max\` of value \`${o}\` supplied to \`${l}\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`}(i,s)):null},value(e,t,s){const n=e[t],i=String(n),o=de(e.max)?e.max:100;return n==null||He(n,o)?null:new Error(function(l,a){return`Invalid prop \`value\` of value \`${l}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` if the progress is indeterminate.

Defaulting to \`null\`.`}(i,s))}};const gs=d.forwardRef((e,t)=>{var s;const{__scopeProgress:n,...i}=e,o=ps("ProgressIndicator",n);return d.createElement(ze.div,fe({"data-state":Be(o.value,o.max),"data-value":(s=o.value)!==null&&s!==void 0?s:void 0,"data-max":o.max},i,{ref:t}))});function vs(e,t){return`${Math.round(e/t*100)}%`}function Be(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function Z(e){return typeof e=="number"}function de(e){return Z(e)&&!isNaN(e)&&e>0}function He(e,t){return Z(e)&&!isNaN(e)&&e<=t&&e>=0}const bs=Fe,ys=gs;function Qs({className:e,variant:t="primary",value:s,max:n,getValueLabel:i}){const o=(l,a)=>Math.round(a/l*100);return r(bs,{className:H("Progress",`Progress--${t}`,e),value:s,max:n,getValueLabel:i,children:r(ys,{style:{width:`${o(n,s)}%`},className:"Progress__indicator"})})}let Ms=0;function en(e){const t=gt(),{exitWorld:s}=St(),n=d.useCallback((o,l)=>{const{reload:a}=l??{},c=vt(e.rooms,o.id),u=a?`?reload=${++Ms}`:"";t(`/world/${c??o.id}${u}`)},[e.rooms,t]),i=d.useCallback(()=>{s(),t("/")},[t,s]);return{navigateEnterWorld:n,navigateExitWorld:i}}function Ss(e){const[t,s]=d.useState([]);return d.useEffect(()=>{var o;if(!e)return;let n;const i=l=>{const a=l.entries;n=a.subscribe({onReset:()=>s(Array.from(a)),onAdd:()=>s(Array.from(a)),onUpdate:()=>s(Array.from(a)),onMove:()=>s(Array.from(a)),onRemove:()=>s(Array.from(a))}),s(Array.from(a))};return(o=e._timeline)!=null&&o.entries?i(e._timeline):e.openTimeline().then(i),()=>{n==null||n()}},[e]),t}function tn(e){return(s=>{if(!(!s||s.length===0))for(let n=s.length-1;n>=0;n-=1){const i=s[n],o=i==null?void 0:i.event;if((o==null?void 0:o.type)==="m.room.encrypted"||(o==null?void 0:o.type)==="m.room.message")return i}})(Ss(e))}const sn="/assets/mic-05083630.svg",nn="/assets/mic-off-738a52d6.svg",rn="/assets/call-cross-54da7b64.svg",on="/assets/message-a538e66d.svg";function Is(){const[e,t]=d.useState(localStorage.getItem("microphone")==="true");return localStorage.setItem("microphone",e.toString()),[e,t]}function Cs(e){const t=d.useCallback(()=>{var l;return((l=e==null?void 0:e.muteSettings)==null?void 0:l.microphone)??!1},[e]),[s,n]=d.useState(t());d.useEffect(()=>(n(t()),e==null?void 0:e.disposableOn("change",()=>{n(t())})),[e,t]);const i=d.useCallback(()=>{if(!e)return;const{muteSettings:l}=e,a=!t();if(n(a),!l){n(t());return}return setTimeout(async()=>{await e.setMuted(l.toggleMicrophone()),n(t())}),a},[e,t]);return{mute:s,toggleMute:i,handleMute:async l=>{var u,m;if(!e)return;if((u=e.localMedia)!=null&&u.userMedia){i();return}const a=await l();if(!a)return;const c=(m=e.localMedia)==null?void 0:m.withUserMedia(a);c&&e.setMedia(c)}}}const xs=({micException:e,setMicException:t})=>e?r(Ct,{open:!!e,title:"Microphone",content:r(C,{variant:"b2",children:ls(e)}),requestClose:()=>t(void 0)}):null,ws=e=>{const{platform:t}=A(!0),s=cs("microphone"),n=ds(t,s),[i,o]=d.useState(),[l,a]=Is(),{mute:c,handleMute:u}=Cs(e);return c===l&&a(!l),{mute:c,requestStream:n,handleMute:u,micException:i,setMicException:o}},Ns=async(e,t)=>{const[s,n]=await e(!0,!1);if(s)return s;t(n)};function qe(e=!0){const t=G();d.useEffect(()=>{if(!e)return;const s=le(t,_t),n=le(t,Rt);s.disableInputStack.length===0&&!n.orbiting&&document.pointerLockElement===t.canvas&&document.exitPointerLock();const i=s.nextStackId++;return s.disableInputStack.push(i),()=>{const o=s.disableInputStack.indexOf(i);o!==-1&&s.disableInputStack.splice(o,1),s.disableInputStack.length===0&&!n.orbiting&&t.canvas.isConnected&&t.canvas.requestPointerLock()}},[e,t])}const an=Ie(!1);function x({variant:e="surface",size:t="md",children:s}){let n="b1";return t==="sm"&&(n="b2"),t==="xs"&&(n="b3"),r("kbd",{className:H("Kbd",`Kbd--${e} Kbd--${t}`),children:typeof s=="string"?r(C,{weight:"medium",variant:n,color:e,type:"span",children:s}):s})}const ks="nametags-enable-message";function As(){const e=(t,s)=>b("div",{className:"flex items-center",children:[r(C,{variant:"b2",className:"grow",children:t}),r("div",{className:"inline-flex items-center gap-xs",children:s})]});return b("div",{className:"ShortcutUI",children:[b("div",{className:"ShortcutUI__main",children:[b(C,{className:"flex flex-column items-center gap-xs",children:[r(x,{size:"lg",children:"W"}),b("span",{className:"flex items-center gap-xs",children:[r(x,{size:"lg",children:"A"}),r(x,{size:"lg",children:"S"}),r(x,{size:"lg",children:"D"})]})]}),r(C,{className:"text-center",style:{marginTop:"var(--sp-lg)"},children:"Use the WASD keys and mouse to move around and explore worlds."})]}),r(z,{header:r(F,{title:"Action",options:r(ge,{children:"Key"})}),children:b("div",{className:"ShortcutUI__list",children:[e("Run",r(x,{size:"xs",children:"Shift"})),e("Jump",r(x,{size:"xs",children:"Space"})),e("Spawn Objects",b(T,{children:[r(x,{size:"xs",children:"1"})," - ",r(x,{size:"xs",children:"6"})]})),e("Grab/Drop Object",r(T,{children:r(x,{size:"xs",children:"E"})})),e("Grab/Throw Object",r(T,{children:r(U,{src:xt})})),e("Delete Object",r(x,{size:"xs",children:"X"})),e("Fly Mode",r(x,{size:"xs",children:"B"})),e("Third Person Camera Toggle",r(x,{size:"xs",children:"V"})),e("Show Statistics",b(T,{children:[r(x,{size:"xs",children:"Ctrl"}),r("span",{children:"+"}),r(x,{size:"xs",children:"Shift"}),r("span",{children:"+"}),r(x,{size:"xs",children:"S"})]}))]})})]})}const cn=()=>{const e=Me(Bt),t=Me(It);_.useRegisterActions([{id:"user-profile",name:"User Profile",shortcut:void 0,keywords:"user profile",section:"Global",icon:void 0,subtitle:void 0,perform:()=>{t(!0),e({type:Ee.UserProfile})},parent:void 0}],[])},ln=()=>{const{session:e}=A(!0),{accountManagementUrl:t}=e.sessionInfo;_.useRegisterActions([{id:"manage-account",name:"Manage Account",shortcut:void 0,keywords:"account",section:"Global",icon:void 0,subtitle:void 0,perform:()=>window.open(t),parent:void 0}],[t])},dn=()=>{_.useRegisterActions([{id:"landing-page",name:"Landing Page",shortcut:void 0,keywords:"landing home preview",section:"Global",icon:void 0,subtitle:void 0,perform:()=>{document.location="/landing"},parent:void 0}],[])},un=({activeCall:e,showToast:t})=>{const{mute:s,requestStream:n,handleMute:i,micException:o,setMicException:l}=ws(e);return _.useRegisterActions([{id:"toggle-mute",name:"Toggle Mute",shortcut:["M"],keywords:"mute",section:"World",icon:void 0,subtitle:void 0,perform:()=>{t==null||t(s?"Microphone Unmuted":"Microphone Muted"),i(async()=>Ns(n,l))},parent:void 0}],[n,t,s]),r(xs,{micException:o,setMicException:l})},mn=(e,t,s)=>{const n=G(),i=d.useCallback(()=>{const o=!e;t(o),n.sendMessage(Et.Game,{type:ks,enabled:o}),s==null||s(o?"Show Names":"Hide Names")},[n,e,s,t]);_.useRegisterActions([{id:"toggle-names",name:"Toggle Names",shortcut:["N"],keywords:"preview",section:"World",icon:void 0,subtitle:void 0,perform:()=>i(),parent:void 0}],[i])},hn=({world:e})=>{const[t,s]=d.useState(!1);return qe(t),_.useRegisterActions([{id:"members-dialog",name:"Members",shortcut:["P"],keywords:"members",section:"World",icon:void 0,subtitle:void 0,perform:()=>s(n=>!n),parent:void 0}],[]),r(ye,{open:t,onOpenChange:s,children:r(as,{room:e,requestClose:()=>s(!1)})})},fn=()=>{const[e,t]=d.useState(!1);return _.useRegisterActions([{id:"shortcuts-dialog",name:"Shortcuts",shortcut:["/"],keywords:"shortcuts",section:"World",icon:void 0,subtitle:void 0,perform:()=>t(s=>!s),parent:void 0}],[]),qe(e),b(ye,{open:e,onOpenChange:t,children:[r(ve,{left:r(be,{size:"lg",children:"Controls"}),right:r(B,{iconSrc:J,onClick:()=>t(s=>!s),label:"Close"})}),r("div",{className:"flex",style:{height:"600px"},children:r(pe,{type:"hover",children:r(As,{})})})]})},pn=(e,t,s)=>{_.useRegisterActions([{id:"editor",name:"Toggle Editor",shortcut:["`"],keywords:"editor",section:"World",icon:void 0,subtitle:void 0,perform:()=>{t?e(n=>!n):s==null||s("You don't have permission to edit this scene.")},parent:void 0}],[t])},gn=()=>{const e=G();_.useRegisterActions([{id:"physics-debug",name:"Toggle Physics Debug",keywords:"physics debug",section:"World",icon:void 0,subtitle:void 0,perform:()=>{Tt(e)},parent:void 0}],[e])},vn=e=>{_.useRegisterActions([{id:"stats",name:"Toggle Stats",shortcut:["Shift+Control+S"],keywords:"stats",section:"World",icon:void 0,subtitle:void 0,perform:()=>e(t=>!t),parent:void 0}],[])},bn=({enter:e})=>(_.useRegisterActions([{id:"webxr",name:"Enter WebXR",shortcut:["Alt+X"],keywords:"webxr",section:"World",icon:void 0,subtitle:void 0,perform:()=>e(),parent:void 0}],[]),null);export{qs as $,te as A,Vt as B,L as C,ws as D,on as E,xs as F,nn as G,sn as H,Ht as I,Ns as J,rn as K,Is as L,Xt as M,zt as N,Ee as O,Wt as P,Qt as Q,es as R,qe as S,Js as T,Xs as U,an as V,js as W,x as X,cn as Y,ln as Z,dn as _,ee as a,ks as a0,As as a1,mn as a2,pn as a3,gn as a4,vn as a5,un as a6,hn as a7,fn as a8,bn as a9,Gs as aa,qt as b,Ot as c,Ks as d,Os as e,Hs as f,Q as g,Pe as h,Te as i,Qs as j,Bs as k,Jt as l,Ys as m,Ls as n,Bt as o,as as p,cs as q,ds as r,en as s,ls as t,Ft as u,Yt as v,Zt as w,tn as x,z as y,F as z};
//# sourceMappingURL=actions-42459e52.js.map
