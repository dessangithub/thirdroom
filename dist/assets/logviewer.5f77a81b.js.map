{"version":3,"file":"logviewer.5f77a81b.js","sources":["../../logviewer/src/html.js","../../logviewer/src/file.js","../../logviewer/src/main.js"],"sourcesContent":["/*\nCopyright 2020 Bruno Windels <bruno@windels.cloud>\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n// DOM helper functions\n\nexport function isChildren(children) {\n    // children should be an not-object (that's the attributes), or a domnode, or an array\n    return typeof children !== \"object\" || !!children.nodeType || Array.isArray(children);\n}\n\nexport function classNames(obj, value) {\n    return Object.entries(obj).reduce((cn, [name, enabled]) => {\n        if (typeof enabled === \"function\") {\n            enabled = enabled(value);\n        }\n        if (enabled) {\n            return cn + (cn.length ? \" \" : \"\") + name;\n        } else {\n            return cn;\n        }\n    }, \"\");\n}\n\nexport function setAttribute(el, name, value) {\n    if (name === \"className\") {\n        name = \"class\";\n    }\n    if (value === false) {\n        el.removeAttribute(name);\n    } else {\n        if (value === true) {\n            value = name;\n        }\n        el.setAttribute(name, value);\n    }\n}\n\nexport function el(elementName, attributes, children) {\n    return elNS(HTML_NS, elementName, attributes, children);\n}\n\nexport function elNS(ns, elementName, attributes, children) {\n    if (attributes && isChildren(attributes)) {\n        children = attributes;\n        attributes = null;\n    }\n\n    const e = document.createElementNS(ns, elementName);\n\n    if (attributes) {\n        for (let [name, value] of Object.entries(attributes)) {\n            if (name === \"className\" && typeof value === \"object\" && value !== null) {\n                value = classNames(value);\n            }\n            setAttribute(e, name, value);\n        }\n    }\n\n    if (children) {\n        if (!Array.isArray(children)) {\n            children = [children];\n        }\n        for (let c of children) {\n            if (!c.nodeType) {\n                c = text(c);\n            }\n            e.appendChild(c);\n        }\n    }\n    return e;\n}\n\nexport function text(str) {\n    return document.createTextNode(str);\n}\n\nexport const HTML_NS = \"http://www.w3.org/1999/xhtml\";\nexport const SVG_NS = \"http://www.w3.org/2000/svg\";\n\nexport const TAG_NAMES = {\n    [HTML_NS]: [\n        \"br\", \"a\", \"ol\", \"ul\", \"li\", \"div\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\",\n        \"p\", \"strong\", \"em\", \"span\", \"img\", \"section\", \"main\", \"article\", \"aside\",\n        \"pre\", \"button\", \"time\", \"input\", \"textarea\", \"label\", \"form\", \"progress\", \"output\"],\n    [SVG_NS]: [\"svg\", \"circle\"]\n};\n\nexport const tag = {};\n\n\nfor (const [ns, tags] of Object.entries(TAG_NAMES)) {\n    for (const tagName of tags) {\n        tag[tagName] = function(attributes, children) {\n            return elNS(ns, tagName, attributes, children);\n        }\n    }\n}\n","/*\nCopyright 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nexport function openFile(mimeType = null) {\n    const input = document.createElement(\"input\");\n    input.setAttribute(\"type\", \"file\");\n    input.className = \"hidden\";\n    if (mimeType) {\n        input.setAttribute(\"accept\", mimeType);\n    }\n    const promise = new Promise((resolve, reject) => {\n        const checkFile = () => {\n            input.removeEventListener(\"change\", checkFile, true);\n            const file = input.files[0];\n            document.body.removeChild(input);\n            if (file) {\n                resolve(file);   \n            } else {\n                reject(new Error(\"no file picked\"));\n            }\n        }\n        input.addEventListener(\"change\", checkFile, true);\n    });\n    // IE11 needs the input to be attached to the document\n    document.body.appendChild(input);\n    input.click();\n    return promise;\n}\n\nexport function readFileAsText(file) {\n    const reader = new FileReader();\n    const promise = new Promise((resolve, reject) => {\n        reader.addEventListener(\"load\", evt => resolve(evt.target.result));\n        reader.addEventListener(\"error\", evt => reject(evt.target.error));\n    });\n    reader.readAsText(file);\n    return promise;\n}\n","/*\nCopyright 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { tag as t } from \"./html.js\";\nimport { openFile, readFileAsText } from \"./file.js\";\n\nconst main = document.querySelector(\"main\");\n\nlet selectedItemNode;\nlet rootItem;\nlet itemByRef;\n\nconst logLevels = [undefined, \"All\", \"Debug\", \"Detail\", \"Info\", \"Warn\", \"Error\", \"Fatal\", \"Off\"];\n\nmain.addEventListener(\"click\", (event) => {\n  if (event.target.classList.contains(\"toggleExpanded\")) {\n    const li = event.target.parentElement.parentElement;\n    li.classList.toggle(\"expanded\");\n  } else {\n    // allow clicking any links other than .item in the timeline, like refs\n    if (event.target.tagName === \"A\" && !event.target.classList.contains(\"item\")) {\n      return;\n    }\n    const itemNode = event.target.closest(\".item\");\n    if (itemNode) {\n      // we don't want scroll to jump when clicking\n      // so prevent default behaviour, and select and push to history manually\n      event.preventDefault();\n      selectNode(itemNode);\n      history.pushState(null, null, `#${itemNode.id}`);\n    }\n  }\n});\n\nwindow.addEventListener(\"hashchange\", () => {\n  const id = window.location.hash.substr(1);\n  const itemNode = document.getElementById(id);\n  if (itemNode && itemNode.closest(\"main\")) {\n    selectNode(itemNode);\n    itemNode.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" });\n  }\n});\n\nfunction selectNode(itemNode) {\n  if (selectedItemNode) {\n    selectedItemNode.classList.remove(\"selected\");\n  }\n  selectedItemNode = itemNode;\n  selectedItemNode.classList.add(\"selected\");\n  let item = rootItem;\n  let parent;\n  const indices = selectedItemNode.id.split(\"/\").map((i) => parseInt(i, 10));\n  for (const i of indices) {\n    parent = item;\n    item = itemChildren(item)[i];\n  }\n  showItemDetails(item, parent, selectedItemNode);\n}\n\nfunction stringifyItemValue(value) {\n  if (typeof value === \"object\" && value !== null) {\n    return JSON.stringify(value, undefined, 2);\n  } else {\n    return value + \"\";\n  }\n}\n\nfunction showItemDetails(item, parent, itemNode) {\n  const parentOffset = itemStart(parent) ? `${itemStart(item) - itemStart(parent)}ms` : \"none\";\n  const expandButton = t.button(\"Expand recursively\");\n  expandButton.addEventListener(\"click\", () => expandResursively(itemNode.parentElement.parentElement));\n  const start = itemStart(item);\n  const aside = t.aside([\n    t.h3(itemCaption(item)),\n    t.p([t.strong(\"Log level: \"), logLevels[itemLevel(item)]]),\n    t.p([t.strong(\"Error: \"), itemError(item) ? `${itemError(item).name} ${itemError(item).stack}` : \"none\"]),\n    t.p([t.strong(\"Parent offset: \"), parentOffset]),\n    t.p([t.strong(\"Start: \"), new Date(start).toString(), ` (${start})`]),\n    t.p([t.strong(\"Duration: \"), `${itemDuration(item)}ms`]),\n    t.p([t.strong(\"Child count: \"), itemChildren(item) ? `${itemChildren(item).length}` : \"none\"]),\n    t.p([t.strong(\"Forced finish: \"), (itemForcedFinish(item) || false) + \"\"]),\n    t.p(t.strong(\"Values:\")),\n    t.ul(\n      { class: \"values\" },\n      Object.entries(itemValues(item)).map(([key, value]) => {\n        let valueNode;\n        if (key === \"ref\") {\n          const refItem = itemByRef.get(value);\n          if (refItem) {\n            valueNode = t.a({ href: `#${refItem.id}` }, itemCaption(refItem));\n          } else {\n            valueNode = `unknown ref ${value}`;\n          }\n        } else {\n          valueNode = stringifyItemValue(value);\n        }\n        return t.li([t.span({ className: \"key\" }, normalizeValueKey(key)), t.span({ className: \"value\" }, valueNode)]);\n      })\n    ),\n    t.p(expandButton),\n  ]);\n  document.querySelector(\"aside\").replaceWith(aside);\n}\n\nfunction expandResursively(li) {\n  li.classList.add(\"expanded\");\n  const ol = li.querySelector(\"ol\");\n  if (ol) {\n    const len = ol.children.length;\n    for (let i = 0; i < len; i += 1) {\n      expandResursively(ol.children[i]);\n    }\n  }\n}\n\ndocument.getElementById(\"openFile\").addEventListener(\"click\", loadFile);\n\nfunction getRootItemHeader(prevItem, item) {\n  if (prevItem) {\n    const diff = itemStart(item) - itemEnd(prevItem);\n    if (diff >= 0) {\n      return `+ ${formatTime(diff)}`;\n    } else {\n      const overlap = -diff;\n      if (overlap >= itemDuration(item)) {\n        return `ran entirely in parallel with`;\n      } else {\n        return `ran ${formatTime(-diff)} in parallel with`;\n      }\n    }\n  } else {\n    return new Date(itemStart(item)).toString();\n  }\n}\n\nasync function loadFile() {\n  const file = await openFile();\n  const json = await readFileAsText(file);\n  const logs = JSON.parse(json);\n  onLoadLogs(logs);\n}\n\nfunction onLoadLogs(logs) {\n  logs.items.sort((a, b) => itemStart(a) - itemStart(b));\n  rootItem = { c: logs.items };\n  itemByRef = new Map();\n  preprocessRecursively(rootItem, null, itemByRef, []);\n\n  const fragment = logs.items.reduce((fragment, item, i, items) => {\n    const prevItem = i === 0 ? null : items[i - 1];\n    fragment.appendChild(\n      t.section([\n        t.h2(getRootItemHeader(prevItem, item)),\n        t.div({ className: \"timeline\" }, t.ol(itemToNode(item, [i]))),\n      ])\n    );\n    return fragment;\n  }, document.createDocumentFragment());\n  main.replaceChildren(fragment);\n}\n\n// TODO: make this use processRecursively\nfunction preprocessRecursively(item, parentElement, refsMap, path) {\n  item.s = (parentElement?.s || 0) + item.s;\n  if (itemRefSource(item)) {\n    refsMap.set(itemRefSource(item), item);\n  }\n  if (itemChildren(item)) {\n    for (let i = 0; i < itemChildren(item).length; i += 1) {\n      // do it in advance for a child as we don't want to do it for the rootItem\n      const child = itemChildren(item)[i];\n      const childPath = path.concat(i);\n      child.id = childPath.join(\"/\");\n      preprocessRecursively(child, item, refsMap, childPath);\n    }\n  }\n}\n\nconst MS_IN_SEC = 1000;\nconst MS_IN_MIN = MS_IN_SEC * 60;\nconst MS_IN_HOUR = MS_IN_MIN * 60;\nconst MS_IN_DAY = MS_IN_HOUR * 24;\nfunction formatTime(ms) {\n  let str = \"\";\n  if (ms > MS_IN_DAY) {\n    const days = Math.floor(ms / MS_IN_DAY);\n    ms -= days * MS_IN_DAY;\n    str += `${days}d`;\n  }\n  if (ms > MS_IN_HOUR) {\n    const hours = Math.floor(ms / MS_IN_HOUR);\n    ms -= hours * MS_IN_HOUR;\n    str += `${hours}h`;\n  }\n  if (ms > MS_IN_MIN) {\n    const mins = Math.floor(ms / MS_IN_MIN);\n    ms -= mins * MS_IN_MIN;\n    str += `${mins}m`;\n  }\n  if (ms > MS_IN_SEC) {\n    const secs = ms / MS_IN_SEC;\n    str += `${secs.toFixed(2)}s`;\n  } else if (ms > 0 || !str.length) {\n    str += `${ms}ms`;\n  }\n  return str;\n}\n\nfunction itemChildren(item) {\n  return item.c;\n}\nfunction itemStart(item) {\n  return item.s;\n}\nfunction itemEnd(item) {\n  return item.s + item.d;\n}\nfunction itemDuration(item) {\n  return item.d;\n}\nfunction itemValues(item) {\n  return item.v;\n}\nfunction itemLevel(item) {\n  return item.l;\n}\nfunction itemLabel(item) {\n  return item.v?.l;\n}\nfunction itemType(item) {\n  return item.v?.t;\n}\nfunction itemError(item) {\n  return item.e;\n}\nfunction itemForcedFinish(item) {\n  return item.f;\n}\nfunction itemRef(item) {\n  return item.v?.ref;\n}\nfunction itemRefSource(item) {\n  return item.v?.refId;\n}\nfunction itemShortErrorMessage(item) {\n  if (itemError(item)) {\n    const e = itemError(item);\n    return e.name || e.stack.substr(0, e.stack.indexOf(\"\\n\"));\n  }\n}\n\nfunction itemCaption(item) {\n  if (itemType(item) === \"network\") {\n    return `${itemValues(item)?.method} ${itemValues(item)?.url}`;\n  } else if (itemLabel(item) && itemValues(item)?.id) {\n    return `${itemLabel(item)} ${itemValues(item).id}`;\n  } else if (itemLabel(item) && itemValues(item)?.status) {\n    return `${itemLabel(item)} (${itemValues(item).status})`;\n  } else if (itemLabel(item) && itemError(item)) {\n    return `${itemLabel(item)} (${itemShortErrorMessage(item)})`;\n  } else if (itemRef(item)) {\n    const refItem = itemByRef.get(itemRef(item));\n    if (refItem) {\n      return `ref \"${itemCaption(refItem)}\"`;\n    } else {\n      return `unknown ref ${itemRef(item)}`;\n    }\n  } else {\n    return itemLabel(item) || itemType(item);\n  }\n}\nfunction normalizeValueKey(key) {\n  switch (key) {\n    case \"t\":\n      return \"type\";\n    case \"l\":\n      return \"label\";\n    default:\n      return key;\n  }\n}\n\n// returns the node and the total range (recursively) occupied by the node\nfunction itemToNode(item) {\n  const hasChildren = !!itemChildren(item)?.length;\n  const className = {\n    item: true,\n    \"has-children\": hasChildren,\n    error: itemError(item),\n    [`type-${itemType(item)}`]: !!itemType(item),\n    [`level-${itemLevel(item)}`]: true,\n  };\n\n  const id = item.id;\n  let captionNode;\n  if (itemRef(item)) {\n    const refItem = itemByRef.get(itemRef(item));\n    if (refItem) {\n      captionNode = [\"ref \", t.a({ href: `#${refItem.id}` }, itemCaption(refItem))];\n    }\n  }\n  if (!captionNode) {\n    captionNode = itemCaption(item);\n  }\n  const li = t.li([\n    t.div([\n      hasChildren ? t.button({ className: \"toggleExpanded\" }) : \"\",\n      t.a({ className, id, href: `#${id}` }, [\n        t.span({ class: \"caption\" }, captionNode),\n        t.span({ class: \"duration\" }, `(${formatTime(itemDuration(item))})`),\n      ]),\n    ]),\n  ]);\n  if (itemChildren(item) && itemChildren(item).length) {\n    li.appendChild(\n      t.ol(\n        itemChildren(item).map((item) => {\n          return itemToNode(item);\n        })\n      )\n    );\n  }\n  return li;\n}\n\nconst highlightForm = document.getElementById(\"highlightForm\");\n\nhighlightForm.addEventListener(\"submit\", (evt) => {\n  evt.preventDefault();\n  const matchesOutput = document.getElementById(\"highlightMatches\");\n  const query = document.getElementById(\"highlight\").value;\n  if (query) {\n    matchesOutput.innerText = \"Searchingâ€¦\";\n    let matches = 0;\n    processRecursively(rootItem, (item) => {\n      let domNode = document.getElementById(item.id);\n      if (itemMatchesFilter(item, query)) {\n        matches += 1;\n        domNode.classList.add(\"highlighted\");\n        domNode = domNode.parentElement;\n        while (domNode.nodeName !== \"SECTION\") {\n          if (domNode.nodeName === \"LI\") {\n            domNode.classList.add(\"expanded\");\n          }\n          domNode = domNode.parentElement;\n        }\n      } else {\n        domNode.classList.remove(\"highlighted\");\n      }\n    });\n    matchesOutput.innerText = `${matches} matches`;\n  } else {\n    for (const node of document.querySelectorAll(\".highlighted\")) {\n      node.classList.remove(\"highlighted\");\n    }\n    matchesOutput.innerText = \"\";\n  }\n});\n\nfunction itemMatchesFilter(item, query) {\n  if (itemError(item)) {\n    if (valueMatchesQuery(itemError(item), query)) {\n      return true;\n    }\n  }\n  return valueMatchesQuery(itemValues(item), query);\n}\n\nfunction valueMatchesQuery(value, query) {\n  if (typeof value === \"string\") {\n    return value.includes(query);\n  } else if (typeof value === \"object\" && value !== null) {\n    for (const key in value) {\n      if (value.hasOwnProperty(key) && valueMatchesQuery(value[key], query)) {\n        return true;\n      }\n    }\n  } else if (typeof value === \"number\") {\n    return value.toString().includes(query);\n  }\n  return false;\n}\n\nfunction processRecursively(item, callback, parentItem) {\n  if (item.id) {\n    callback(item, parentItem);\n  }\n  if (itemChildren(item)) {\n    for (let i = 0; i < itemChildren(item).length; i += 1) {\n      // do it in advance for a child as we don't want to do it for the rootItem\n      const child = itemChildren(item)[i];\n      processRecursively(child, callback, item);\n    }\n  }\n}\n\ndocument.getElementById(\"collapseAll\").addEventListener(\"click\", () => {\n  for (const node of document.querySelectorAll(\".expanded\")) {\n    node.classList.remove(\"expanded\");\n  }\n});\ndocument.getElementById(\"hideCollapsed\").addEventListener(\"click\", () => {\n  for (const node of document.querySelectorAll(\"section > div.timeline > ol > li:not(.expanded)\")) {\n    node.closest(\"section\").classList.add(\"hidden\");\n  }\n});\ndocument.getElementById(\"hideHighlightedSiblings\").addEventListener(\"click\", () => {\n  for (const node of document.querySelectorAll(\".highlighted\")) {\n    const list = node.closest(\"ol\");\n    const siblings = Array.from(list.querySelectorAll(\"li > div > a:not(.highlighted)\")).map((n) => n.closest(\"li\"));\n    for (const sibling of siblings) {\n      if (!sibling.classList.contains(\"expanded\")) {\n        sibling.classList.add(\"hidden\");\n      }\n    }\n  }\n});\ndocument.getElementById(\"showAll\").addEventListener(\"click\", () => {\n  for (const node of document.querySelectorAll(\".hidden\")) {\n    node.classList.remove(\"hidden\");\n  }\n});\n\nwindow.addEventListener(\"message\", (event) => {\n  if (event.data.hydrogenLogs) {\n    onLoadLogs(event.data.hydrogenLogs);\n  }\n});\n\nwindow.opener.dispatchEvent(new Event(\"log-viewer-ready\"));\n"],"names":["isChildren","children","classNames","obj","value","cn","name","enabled","setAttribute","el","elNS","ns","elementName","attributes","e","c","text","str","HTML_NS","SVG_NS","TAG_NAMES","tag","tags","tagName","openFile","mimeType","input","promise","resolve","reject","checkFile","file","readFileAsText","reader","evt","main","selectedItemNode","rootItem","itemByRef","logLevels","event","itemNode","selectNode","id","item","parent","indices","i","itemChildren","showItemDetails","stringifyItemValue","parentOffset","itemStart","expandButton","t","expandResursively","start","aside","itemCaption","itemLevel","itemError","itemDuration","itemForcedFinish","itemValues","key","valueNode","refItem","normalizeValueKey","li","ol","len","loadFile","getRootItemHeader","prevItem","diff","itemEnd","formatTime","json","logs","onLoadLogs","a","b","preprocessRecursively","fragment","items","itemToNode","parentElement","refsMap","path","itemRefSource","child","childPath","MS_IN_SEC","MS_IN_MIN","MS_IN_HOUR","MS_IN_DAY","ms","days","hours","mins","secs","itemLabel","_a","itemType","itemRef","itemShortErrorMessage","_b","_c","_d","hasChildren","className","captionNode","highlightForm","matchesOutput","query","matches","processRecursively","domNode","itemMatchesFilter","node","valueMatchesQuery","callback","parentItem","list","siblings","n","sibling"],"mappings":"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"}