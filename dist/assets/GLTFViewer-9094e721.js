import{r as o,H as U,e as C,a as r,j as I,T as L,g as M,F as S}from"./main.cc7980d7.js";import{D as F,H as G}from"./index-84625879.js";import{u as k,c as R,r as E,T as p,a as w,M as D,b as P,I as x}from"./editor-9e67c00a.js";import{u as V}from"./mouse-left-107cf13e.js";import{I as _,u as j,S as N,E as W,a as H,R as K}from"./Reticle-a481b0a6.js";import"./modulepreload-polyfill-3cfb730f.js";import"./Deferred-af9e678f.js";import"./DropdownMenu-c9ddf01c.js";import"./Label-b8166eab.js";import"./index.module-9a456540.js";import"./cross-0b515b96.js";import"./common-1b4c5772.js";import"./math-0381bedb.js";import"./SettingTile-abd8ecde.js";function se(){const c=o.useRef(null),a=k(c),[{loading:g,loaded:f,error:m},n]=o.useState({loading:!1,loaded:!1}),{session:l}=o.useContext(U)||{},[h]=C();o.useEffect(()=>{const e=h.get("url");if(!e)return;if(!l){n({loading:!1,loaded:!1,error:"Not signed in"});return}const s=l.mediaRepository.mxcUrl(e);if(!s){n({loading:!1,loaded:!1,error:"Invalid scene url"});return}(async()=>{const b=await(await fetch(s)).blob(),d=URL.createObjectURL(b);a&&d&&(n({loading:!0,loaded:!1}),a.sendMessage(w.Game,{type:p.LoadWorld,environmentUrl:d,id:1}))})().catch(u=>{n({loading:!1,loaded:!0,error:u.message})})},[a,l,h]),o.useEffect(()=>{if(a)return R([E(a,p.WorldLoaded,(e,s)=>{e.sendMessage(w.Game,{type:p.EnterWorld,id:s.id}),n({loading:!1,loaded:!0})}),E(a,p.WorldLoadError,(e,s)=>n({loading:!1,loaded:!0,error:s.error}))])},[a]);const t=o.useCallback(()=>{c.current&&c.current.requestPointerLock()},[]),i=o.useCallback(e=>{if(e.preventDefault(),!e.dataTransfer)return;let s,v;const u=new Map;for(const b of e.dataTransfer.items){const d=b.getAsFile();if(d){const y=URL.createObjectURL(d);d.name.match(/\.gl(?:tf|b)$/)?s=y:d.name.match(/\.(js|wasm)$/)?v=y:u.set(encodeURIComponent(d.name),y)}}a&&s&&(n({loading:!0,loaded:!1}),a.sendMessage(w.Game,{type:p.LoadWorld,id:1,environmentUrl:s,options:{environmentScriptUrl:v,fileMap:u}}))},[a]),T=o.useCallback(e=>{e.preventDefault()},[]);return r(F,{backend:G,children:r(D,{value:a,children:I("div",{className:"GLTFViewer",children:[r("canvas",{className:"GLTFViewer__viewport",ref:c,onClick:t,onDrop:i,onDragOver:T}),a&&f&&r(A,{}),!f&&!g&&!m&&r("div",{className:"GLTFViewer__message",children:r(L,{color:"world",children:"Drag and drop .gltf directory or .glb file to preview it."})}),!f&&g&&r("div",{className:"GLTFViewer__message",children:r(L,{color:"world",children:"Loading scene..."})}),m&&r("div",{className:"GLTFViewer__message",children:r(L,{color:"danger",children:m})})]})})})}function A(){const c=P(),[a,g]=o.useState(!1),[f,m]=o.useState(!1),[n,l]=o.useState();V(t=>{t.code==="Backquote"&&g(i=>!i),t.code==="KeyS"&&t.shiftKey&&t.ctrlKey&&m(i=>!i)},[]);const h=o.useCallback(t=>{if(!t)return l(void 0);const{interactableType:i,action:T,peerId:e}=t;if(T===_.Grab){if(i===x.Player&&typeof e=="string"){console.log("Interacted with player",t),document.exitPointerLock();return}if(i===x.Portal){console.log("Interacted with portal",t);return}}if(i===x.Player){const s={...t,name:e?M(e):"Player"};l(s)}l(t)},[l]);return j(c,h),I(S,{children:[r(N,{statsEnabled:f}),a&&r(W,{}),n&&r(H,{activeEntity:n,portalProcess:{joining:!1}}),r(K,{})]})}export{se as default};
//# sourceMappingURL=GLTFViewer-9094e721.js.map
