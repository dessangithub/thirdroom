import{_ as e,o as t,c as o,O as i}from"./chunks/framework.c0965656.js";const a="/docs/assets/ImportSamples.3973dc6d.png",r="/docs/assets/ProjectSettings.1e25acfc.png",l="/docs/assets/HDRRenderPipeline.f35221f4.png",n="/docs/assets/LightingSettingsAsset.2049ac84.png",s="/docs/assets/GenerateLighting.24c41532.png",d="/docs/assets/Skybox.3bd3d1cd.png",p="/docs/assets/PortalHierarchy.28c62d3a.png",h="/docs/assets/PortalInspector.8e99769f.png",c="/docs/assets/AudioEmitterInspector.e47c1c7a.png",u="/docs/assets/LightingSettings.2cfadd9a.png",m="/docs/assets/ReflectionProbe.f8345e8a.png",g="/docs/assets/BloomSettings.eeadb6a8.png",_=JSON.parse('{"title":"Third Room Unity Exporter","description":"","frontmatter":{},"headers":[],"relativePath":"guides/unity/index.md","filePath":"guides/unity/index.md"}'),b={name:"guides/unity/index.md"},y=i('<h1 id="third-room-unity-exporter" tabindex="-1">Third Room Unity Exporter <a class="header-anchor" href="#third-room-unity-exporter" aria-label="Permalink to &quot;Third Room Unity Exporter&quot;">​</a></h1><p>Export Third Room scenes from Unity. Powered by UnityGLTF.</p><h2 id="contents" tabindex="-1">Contents <a class="header-anchor" href="#contents" aria-label="Permalink to &quot;Contents&quot;">​</a></h2><ul><li><a href="#installation">Installation</a></li><li><a href="#scene-setup">Scene Setup</a></li><li><a href="#spawn-points">Spawn Points</a></li><li><a href="#portals">Portals</a></li><li><a href="#colliders">Colliders</a></li><li><a href="#skybox">Skybox</a></li><li><a href="#audio">Audio</a></li><li><a href="#lights-and-lightmaps">Lights and Lightmaps</a></li><li><a href="#reflection-probes">Reflection Probes</a></li><li><a href="#optimization-and-uploading">Optimization and Uploading</a></li><li><a href="#getting-help">Getting Help</a></li></ul><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><p>First you&#39;ll need a copy of Unity which can be downloaded <a href="https://unity.com/download" target="_blank" rel="noreferrer">here</a>.</p><p>Internally we use Unity 2021.3.17f1 (LTS), Unity versions 2020.3+ should be supported, but we can&#39;t make any promises. 2021.3+ would be preferred.</p><p>You should use the Universal Render Pipeline (URP) to maximize compatibility with UnityGLTF.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If you are a macOS user and see this error when trying to import packages via git URL:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun</span></span></code></pre></div><p>Run <code>xcode-select --install</code> in order for git import of packages to function properly.</p></div><p>This package depends on a branch of UnityGLTF that needs to be installed before you install the exporter.</p><ol><li>Open <code>Window &gt; Package Manager</code></li><li>In Package Manager, click <kbd>+</kbd> and select <kbd>Add Package from git URL</kbd></li><li>Paste <code>https://github.com/matrix-org/UnityGLTF.git?path=/UnityGLTF/Assets/UnityGLTF#thirdroom/dev</code></li><li>Click <kbd>Add</kbd>.</li></ol><p>After that is installed you can do the same thing for the Third Room Exporter:</p><ol><li>In Package Manager, click <kbd>+</kbd> and select <kbd>Add Package from git URL</kbd></li><li>Paste <code>https://github.com/matrix-org/thirdroom-unity-exporter.git?path=/Packages/thirdroom-unity-exporter</code></li><li>Click <kbd>Add</kbd>.</li></ol><p>You&#39;ll also probably want to add the Sample Scenes which contains an example scene, a portal asset, and default settings assets for you to use in your project.</p><p>Install the sample scenes in the Package Manager by pressing <kbd>Import</kbd> under the Samples dropdown.</p><p><img src="'+a+'" alt="Import Samples"></p><h2 id="scene-setup" tabindex="-1">Scene Setup <a class="header-anchor" href="#scene-setup" aria-label="Permalink to &quot;Scene Setup&quot;">​</a></h2><p>Whether you&#39;re working with an existing scene or starting one from scratch there&#39;s a few things you&#39;ll want to check before you get started.</p><h3 id="project-settings" tabindex="-1">Project Settings <a class="header-anchor" href="#project-settings" aria-label="Permalink to &quot;Project Settings&quot;">​</a></h3><ol><li>Open <code>Edit &gt; Project Settings...</code></li><li>Ensure that <kbd>Color Space</kbd> is set to <code>Linear</code></li><li>Ensure that <kbd>Lightmap Encoding</kbd> is set to <code>Normal Quality</code></li><li>If you&#39;re using Unity 2022, ensure that <kbd>HDR Cubemap Encoding</kbd> is set to <code>Normal Quality</code></li></ol><p><img src="'+r+'" alt="Project Settings"></p><p>If these settings aren&#39;t set, your lighting may look fine in Unity, but it&#39;ll look off when exporting and importing into Third Room.</p><h3 id="render-pipeline-settings" tabindex="-1">Render Pipeline Settings <a class="header-anchor" href="#render-pipeline-settings" aria-label="Permalink to &quot;Render Pipeline Settings&quot;">​</a></h3><p>You can find your render pipeline assets in your project&#39;s <code>Settings</code> directory. New projects are typically set up to use the High Fidelity render pipeline while in the editor. Open up the asset and ensure that HDR is turned on. It should be already.</p><p><img src="'+l+'" alt="HDR Render Pipeline Settings"></p><h3 id="lighting-settings" tabindex="-1">Lighting Settings <a class="header-anchor" href="#lighting-settings" aria-label="Permalink to &quot;Lighting Settings&quot;">​</a></h3><p>You will need to setup Lighting Settings properly in order to export as glTF from Unity3D.</p><ol><li>Open <code>Window &gt; Rendering &gt; Lighting</code></li><li>Select <code>ThirdRoomDefaultLightingSettings</code> as the Lighting Settings Asset</li><li>At the botton of the Lighting panel, make sure to click the <code>Generate Lighting</code> button before exporting as glTF</li></ol><p><img src="'+n+'" alt="Lighting Settings Asset"><img src="'+s+'" alt="Generate Lighting"></p><h3 id="materials" tabindex="-1">Materials <a class="header-anchor" href="#materials" aria-label="Permalink to &quot;Materials&quot;">​</a></h3><p>We find that the <code>UnityGLTF/PBRGraph</code> material works best for exported scenes. You can convert to <code>UnityGLTF/PBRGraph</code> material from the following shaders with automatic conversions:</p><ul><li><code>Standard</code></li><li><code>URP/Lit</code></li><li><code>URP/Unlit</code></li></ul><p>To do so change the shader on the selected material to <code>UnityGLTF/PBRGraph</code>.</p><p>For all new materials, set the <code>UnityGLTF/PBRGraph</code> shader before you start setting properties.</p><p>Note that Third Room does not yet have support for the following extensions:</p><ul><li>KHR_matrials_irridescence</li><li>KHR_materials_specular</li><li>KHR_materials_clearcoat</li></ul><p>Upon import those extensions will be ignored. We hope to support them in the future.</p><p>More information on UnityGLTF&#39;s materials can be found <a href="https://github.com/prefrontalcortex/UnityGLTF/tree/dev#gltf-materials" target="_blank" rel="noreferrer">here</a>.</p><h2 id="exporting-a-scene" tabindex="-1">Exporting a Scene <a class="header-anchor" href="#exporting-a-scene" aria-label="Permalink to &quot;Exporting a Scene&quot;">​</a></h2><p>Once you have a scene ready to be exported to Third Room follow these steps to export it and test it out:</p><ol><li>Click <code>Assets &gt; UnityGLTF &gt; Export active scene as glTF</code></li><li>Pick an output directory</li><li>Open <a href="https://thirdroom.io/viewer" target="_blank" rel="noreferrer">https://thirdroom.io/viewer</a> in your browser.</li><li>Drag and drop the entire contents of the output directory into the viewer.</li></ol><p>You should see your output scene in the viewer. If you haven&#39;t placed a spawn point yet you&#39;ll be flying around the space. It may also be lit incorrectly and be very expensive to render. In the following sections we&#39;ll go over all of the supported features of the Third Room Unity Exporter.</p><h2 id="camera" tabindex="-1">Camera <a class="header-anchor" href="#camera" aria-label="Permalink to &quot;Camera&quot;">​</a></h2><p>If one or more camera is included in your exported scene, the first camera will be used as the &quot;preview camera&quot; that is shown when you&#39;ve loaded an environment, but not yet entered the world.</p><p>A quick and easy way to position this camera is:</p><ol><li>Move your viewport to the position and orientation you&#39;d like to set.</li><li>Select your camera</li><li>Click <code>GameObject &gt; Align With View</code></li></ol><p>The camera&#39;s projection will also be exported along with the scene so you can set the appropriate settings there as well.</p><h2 id="spawn-points" tabindex="-1">Spawn Points <a class="header-anchor" href="#spawn-points" aria-label="Permalink to &quot;Spawn Points&quot;">​</a></h2><p>When you click <code>Enter World</code> Spawn points are where your avatar will be placed. A spawn point is chosen at random when you enter the world.</p><p>To place a spawn point:</p><ol><li>Create a new empty object</li><li>Click <code>Add Component</code></li><li>Search for <code>Spawn Point Behavior</code></li><li>Position your spawn point so that it is slightly above the ground beneath it and so that the arrow inside the capsule is facing forward.</li></ol><h2 id="colliders" tabindex="-1">Colliders <a class="header-anchor" href="#colliders" aria-label="Permalink to &quot;Colliders&quot;">​</a></h2><p>Colliders can be easily exported with the Third Room Unity Exporter. The following colliders are exported:</p><ul><li>Box Collider</li><li>Sphere Collider</li><li>Capsule Collider</li><li>Mesh Collider</li></ul><p>Physic materials and the <code>Is Trigger</code> properties are not yet supported. And all colliders will be static rigid bodies when they are imported into Third Room (they don&#39;t move). This does mean that your player will collide with them and can walk around on them though.</p><p>Typically you should pick the simplest collider for your meshes instead of using a complex mesh collider. Try creating approximations of mesh colliders out of multiple primitive colliders like boxes, spheres, and capsules.</p><h2 id="skybox" tabindex="-1">Skybox <a class="header-anchor" href="#skybox" aria-label="Permalink to &quot;Skybox&quot;">​</a></h2><p>The Third Room Unity Exporter will export the skybox set in the scene&#39;s environment settings.</p><p>You&#39;ll want to make sure a couple settings are set here for best results:</p><ol><li>Set the environment reflection resolution to 128 (or whatever resolution your reflection probes are set to)</li><li>Set the environment reflection compression to <code>Uncompressed</code>. We&#39;re going to compress with Basis Universal anyway so no need to compress twice.</li></ol><p><img src="'+d+'" alt="Skybox Settings"></p><p>To set your own skybox:</p><ol><li>Open <code>Window &gt; Rendering &gt; Lighting</code></li><li>Open the <code>Environment</code> tab</li><li>Replace the skybox material with any compatible material.</li></ol><p>Upon export the skybox will be captured as a cubemap and exported. Dynamic skybox shaders will be captured as they are.</p><h2 id="portals" tabindex="-1">Portals <a class="header-anchor" href="#portals" aria-label="Permalink to &quot;Portals&quot;">​</a></h2><p>Portals represent links to other Worlds across the Matrix network and eventually, virtual worlds across the entire metaverse.</p><h3 id="portal-prefab" tabindex="-1">Portal Prefab <a class="header-anchor" href="#portal-prefab" aria-label="Permalink to &quot;Portal Prefab&quot;">​</a></h3><p>The thirdroom-unity-exporter package contains a default portal prefab in the samples that you may have imported from the Package Manager window.</p><ol><li>In the Project go to the <code>Samples &gt; Third Room Unity Exporter &gt; x.x.x &gt; Sample Scenes &gt; Prefabs</code> directory.</li><li>Drag the <code>Portal</code> prefab into your scene where you want to place it.</li><li>Select the <code>Portal Target</code> object inside the Portal GameObject you just placed in the <code>Hierarchy</code> panel.</li><li>In the inspector there is a component <code>MX Portal Behaviour</code> with a single property <code>Uri</code>. You can change this to any Matrix Room URI (we&#39;ll explain the URI format below). For now you can keep this set to <code>matrix:r/terra-1:thirdroom.io</code> which represents a link to the room <code>#terra-1:thirdroom.io</code></li><li>Replace the thumbnail of the portal by replacing the material on the prefab&#39;s <code>Portal Thumbnail</code> object. We recommend that you set the <code>Render Face</code> to <code>Both</code> and set both a <code>Base Color Map</code> and <code>Emissive Map</code> so that the portal can be seen from both sides and seems to glow even in dark environments.</li></ol><p><img src="'+p+'" alt="Portal Hierarchy"></p><h3 id="custom-portals" tabindex="-1">Custom Portals <a class="header-anchor" href="#custom-portals" aria-label="Permalink to &quot;Custom Portals&quot;">​</a></h3><p>However, you can make a portal out of any object and make them look like whatever you want.</p><p>To create a custom portal you:</p><ol><li>Add a collider to act as the &quot;Portal Target&quot; this will be used to check if the user is hovering over the portal.</li><li>Add the <code>MX Portal Behaviour</code> component to the same object as the collider.</li><li>Set a valid Matrix URI</li></ol><p><img src="'+h+'" alt="Portal Inspector"></p><h3 id="matrix-uris" tabindex="-1">Matrix URIs <a class="header-anchor" href="#matrix-uris" aria-label="Permalink to &quot;Matrix URIs&quot;">​</a></h3><p>Matrix URIs replace the <code>#</code> or <code>!</code> character with <code>r/</code> or <code>roomid/</code> respectively. So <code>#myroom:myhomeserver.com</code> becomes <code>matrix:r/myroom:myhomeserver.com</code> and <code>!1234abcdefg:myhomeserver.com</code> becomes <code>matrix:roomid/1234abcdefg:myhomeserver.com</code></p><p>You can read more on the Matrix URI spec <a href="https://github.com/matrix-org/matrix-spec-proposals/blob/main/proposals/2312-matrix-uri.md" target="_blank" rel="noreferrer">here</a>.</p><h2 id="audio" tabindex="-1">Audio <a class="header-anchor" href="#audio" aria-label="Permalink to &quot;Audio&quot;">​</a></h2><p>The Third Room Unity Exporter supports exporting both positional and global audio emitters.</p><p>Audio support is broken into three components:</p><ul><li>Audio Clips</li><li>Audio Sources</li><li>Audio Emitters</li></ul><h3 id="global-audio-emitters" tabindex="-1">Global Audio Emitters <a class="header-anchor" href="#global-audio-emitters" aria-label="Permalink to &quot;Global Audio Emitters&quot;">​</a></h3><p>Global audio emitters are stereo or mono emitters that do not have any spatialization. They can represent ambient audio that should be heard throughout the map.</p><p>To create a global audio emitter:</p><ol><li>Create a new empty object</li><li>Add the <code>KHR Global Audio Emitter Behavior</code></li><li>Set the appropriate gain</li><li>Set one or more sources (described below in a later section)</li></ol><h3 id="positional-audio-emitters" tabindex="-1">Positional Audio Emitters <a class="header-anchor" href="#positional-audio-emitters" aria-label="Permalink to &quot;Positional Audio Emitters&quot;">​</a></h3><p>Positional audio emitters are spatialized and have a cone-based model to simulate audio falloff.</p><p>To create a positional audio emitter:</p><ol><li>Create a new empty object</li><li>Add the <code>KHR Positional Audio Emitter Behavior</code></li><li>Set the appropriate gain and positional properties. They are described more in detail <a href="https://github.com/KhronosGroup/glTF/blob/5d3a2a35d139c72a7001aa4872041572b2e42fae/extensions/2.0/Khronos/KHR_audio/README.md#audio-emitter" target="_blank" rel="noreferrer">here</a>.</li><li>Set one or more sources (described below)</li></ol><p><img src="'+c+'" alt="Audio Emitter Inspector"></p><h3 id="audio-sources" tabindex="-1">Audio Sources <a class="header-anchor" href="#audio-sources" aria-label="Permalink to &quot;Audio Sources&quot;">​</a></h3><p>Audio sources are used to control and synchronize the playback of an audio clip on one or more audio emitters. They are represented as Scriptable Objects in Unity so that you can reference them in multiple audio emitters.</p><p>To create an audio source:</p><ol><li>Right click inside a directory in your <code>Project</code>.</li><li>Click <code>Create &gt; UnityGLTF &gt; AudioSource</code></li><li>Set the <code>Clip</code> property to any MP3 audio clip (it must be a .mp3)</li><li>Set the gain appropriately</li><li>Auto Play will play this clip once the environment is loaded.</li><li>Loop will continue looping the audio clip once it is finished.</li></ol><h2 id="lights-and-lightmaps" tabindex="-1">Lights and Lightmaps <a class="header-anchor" href="#lights-and-lightmaps" aria-label="Permalink to &quot;Lights and Lightmaps&quot;">​</a></h2><p>The Third Room Unity Exporter has native support for exporting Unity&#39;s lightmaps and it&#39;s generally preferred over exporting dynamic lights.</p><p>Realtime, mixed, and dynamic lights are supported. The current supported light types are:</p><ul><li>Directional Light (Only one is supported in Third Room and currently the position matters)</li><li>Spot Light</li><li>Point Light</li></ul><p>All lights currently cast shadows so that setting has no effect for realtime lights. We&#39;re still working on getting dynamic/mixed lighting support up to the level of quality we&#39;d like to see. And the performance of mixed/dynamic lighting is still quite bad. If you are going to use dynamic lights, use one directional light set to &quot;Mixed&quot; lighting and orient it so that it is in view of the place you&#39;d like to cover with shadows. We&#39;re adding support for cascading shadow maps soon, so the position of the directional light is only a temporary measure.</p><p>The preferred workflow for lighting is baked lighting.</p><p>If you&#39;re new to baked lighting in Unity you can read more on the process <a href="https://docs.unity3d.com/2018.4/Documentation/Manual/LightMode-Baked.html" target="_blank" rel="noreferrer">here</a>. Third Room will include the baked lightmaps on export and place lightmap UVs on the second UV set. Third Room needs a few lightmap settings to be set correctly for the exported lightmap to work correctly.</p><h3 id="lightmap-settings" tabindex="-1">Lightmap Settings <a class="header-anchor" href="#lightmap-settings" aria-label="Permalink to &quot;Lightmap Settings&quot;">​</a></h3><p>Included in the samples directory is a <code>ThirdRoomDefaultLightingSettings</code> file which has some decent default lighting settings for most scenes.</p><p>The important bits of the lighting settings are:</p><ul><li>Lighting Mode: <code>Baked Indirect</code></li><li>Directional Mode: <code>Non-Directional</code></li></ul><p>You may have to tweak the lightmap resolution depending on the size and complexity of your scene. If it&#39;s taking too long start low with something like 4 texels per unit and work your way up. You may also want to boost your max lightmap size to reduce the number of lightmaps needed and reduce the wasted space on your lightmaps. Experiment with different settings until you get the look and file size you want.</p><p><img src="'+u+'" alt="Lighting Settings"></p><h2 id="reflection-probes" tabindex="-1">Reflection Probes <a class="header-anchor" href="#reflection-probes" aria-label="Permalink to &quot;Reflection Probes&quot;">​</a></h2><p>Unity&#39;s reflection probes are also exported with the scene.</p><p>Reflection probes should have the following settings set:</p><ul><li>Type: <code>Baked</code></li><li>Box Projection: Should be unchecked, Third Room doesn&#39;t support it.</li><li>Box Offset: Should be set to 0,0,0 Third Room doesn&#39;t support it.</li><li>Resolution: <code>128</code> recommended for performance, you can change the resolution, but the important thing is that they are all the same.</li><li>HDR: Must be checked</li></ul><p>Third Room also uses the Environment Reflections settings in the Lighting window under the Environment tab. They should be set to:</p><ul><li>Source: <code>Skybox</code></li><li>Resolution: <code>128</code> or whatever you set for all the other reflection probes.</li></ul><p><img src="'+m+'" alt="Reflection Probe Settings"></p><h2 id="postprocessing" tabindex="-1">Postprocessing <a class="header-anchor" href="#postprocessing" aria-label="Permalink to &quot;Postprocessing&quot;">​</a></h2><p>We support exporting your global Unity Postprocessing settings. Currently we only support the following properties from Bloom: threshold, intensity, and scatter.</p><p><img src="'+g+'" alt="Bloom Settings"></p><h2 id="optimization-and-uploading" tabindex="-1">Optimization and Uploading <a class="header-anchor" href="#optimization-and-uploading" aria-label="Permalink to &quot;Optimization and Uploading&quot;">​</a></h2><p>Third Room uses a custom glTF-Transform pipeline to apply optimizations to the final glTF files. These optimizations include:</p><ul><li>Removing unused glTF accessors, images, materials, and meshes</li><li>Resizing textures: 2048x2048 for baseColorTexture and emissiveTexture, 1024x1024 for metallicRoughnessTexture, occlusionTexture, and normalTexture</li><li>Marking nodes using the same mesh for instanced rendering</li><li>Compressing textures with Basis Texture compression or OptiPNG (RGBM encoded lightmaps and reflection probes)</li></ul><p>To optimize you assets follow these steps:</p><ol><li>Export your glTF scene by clicking <code>Assets &gt; UnityGLTF &gt; Export active scene as glTF</code></li><li>Select your output directory</li><li>Open <a href="https://thirdroom.io/pipeline" target="_blank" rel="noreferrer">https://thirdroom.io/pipeline</a></li><li>Drag and drop the files from your output directory onto the pipeline page</li><li>Open your browser&#39;s console to see the optimization pipeline&#39;s logs</li><li>Wait a while... compressing textures takes a while. It&#39;s multithreaded, using WASM, but it&#39;s still going to take time.</li><li>Find the final optimized file in your download folder.</li><li>Test it out on <a href="https://thirdroom.io/viewer" target="_blank" rel="noreferrer">https://thirdroom.io/viewer</a></li><li>If you&#39;re satisfied with the results create a new world or change the scene of one of your worlds using the output .glb file.</li></ol><h2 id="getting-help" tabindex="-1">Getting Help <a class="header-anchor" href="#getting-help" aria-label="Permalink to &quot;Getting Help&quot;">​</a></h2><p>This exporter and our asset pipeline in general has yet to be put through its paces. Especially outside our team. If you find a bug, please report it here in GitHub issues. If you&#39;re having a hard time figuring something out and need help, join us in the Third Room Matrix Room <a href="https://matrix.to/#/#thirdroom-dev:matrix.org" target="_blank" rel="noreferrer">here</a>. Also, we&#39;d love to see progress of your work! Send us your progress shots in the Matrix Room or tag us on Twitter (@thirdroomio).</p>',125),f=[y];function x(w,k,P,T,S,v){return t(),o("div",null,f)}const q=e(b,[["render",x]]);export{_ as __pageData,q as default};
